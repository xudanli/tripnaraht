# æ•°æ®æ²»ç†æ¶æ„åˆ†æ

## ğŸ“‹ ç›®æ ‡æ¶æ„ï¼šåˆ†å±‚æ•°æ®æ²»ç†æ¨¡å¼

### 1. å…¨çƒé€šç”¨å±‚ (Global Foundation)
é€šè¿‡ GDS å’Œå¤§å¹³å° API è¦†ç›– 80% éœ€æ±‚ï¼š
- **é…’åº—ä¸èˆªç­**ï¼šAmadeusã€Skyscannerã€Booking API
- **åŸºç¡€åœ°ç† (POI)**ï¼šGoogle Placesã€Mapbox
- **åŸºç¡€å¤©æ°”**ï¼šOpenWeather
- **ç­¾è¯åŸºç¡€**ï¼šSherpa API

### 2. å›½å®¶/åœºæ™¯æ’ä»¶å±‚ (Country-Specific Modules)
é’ˆå¯¹é«˜å®¢å•ä»·/é«˜éš¾åº¦åœºæ™¯çš„å®šåˆ¶æ•°æ®æºï¼š
- **å†°å²›**ï¼šSafeTravel / Road.isï¼ˆè·¯å†µã€å¤©æ°”ï¼‰
- **ç‘å£«**ï¼šSBB APIï¼ˆç²¾ç¡®ç«è½¦æ—¶åˆ»è¡¨ï¼‰
- **ä¸­å›½**ï¼šé«˜å¾·/ç™¾åº¦/æºç¨‹ API
- **æ—¥æœ¬**ï¼šNavitime / Yahoo Transit
- **æŒªå¨/æ™ºåˆ©**ï¼šè½®æ¸¡æ—¶åˆ»è¡¨

### 3. é€‚é…å™¨æ¨¡å¼ (Adapter Pattern)
- å®šä¹‰æ ‡å‡†æ•°æ®å¥‘çº¦ (Contract)
- å¼€å‘ç‰¹å®šé€‚é…å™¨
- æŒ‰éœ€è§¦å‘ï¼ˆæ ¹æ®ç»çº¬åº¦è‡ªåŠ¨åŠ è½½ï¼‰

---

## ğŸ” å½“å‰æ¶æ„æ£€æŸ¥

### âœ… å·²å®ç°çš„éƒ¨åˆ†

#### 1. å…¨çƒé€šç”¨å±‚ - éƒ¨åˆ†å®ç°

**POI æ•°æ®**ï¼š
- âœ… `google-places.service.ts` - Google Places API
- âœ… `mapbox.service.ts` - Mapbox API
- âœ… `overpass.service.ts` - OSM Overpass API

**å›½å®¶ç‰¹å®š POI**ï¼š
- âœ… `amap-poi.service.ts` - é«˜å¾·åœ°å›¾ï¼ˆä¸­å›½ç‰¹å®šï¼‰

**å›½å®¶é…ç½®**ï¼š
- âœ… `country-pack.config.ts` - å›½å®¶ç‰¹å®šçš„åœ°å½¢ç­–ç•¥é…ç½®
- âœ… `CountryProfile` è¡¨ - å›½å®¶æ¡£æ¡ˆï¼ˆè´§å¸ã€æ”¯ä»˜ã€ç­¾è¯ç­‰ï¼‰

#### 2. å›½å®¶/åœºæ™¯æ’ä»¶å±‚ - éƒ¨åˆ†å®ç°

**å·²å®ç°çš„å›½å®¶ç‰¹å®šæœåŠ¡**ï¼š
- âœ… ä¸­å›½ï¼š`amap-poi.service.ts`
- âœ… åœ°å½¢ç­–ç•¥ï¼š`country-pack.config.ts` æ”¯æŒ CN_XIZANG, CN_SICHUAN, NP, NZ

**POI æ•°æ®æŠ“å–**ï¼š
- âœ… æŒªå¨ã€å†°å²›ã€æ ¼é™µå…°ã€æ–¯ç“¦å°”å·´ã€è¥¿è—ã€æ–°è¥¿å…°çš„ OSM POI æŠ“å–è„šæœ¬

---

## âŒ ç¼ºå¤±çš„éƒ¨åˆ†

### 1. å…¨çƒé€šç”¨å±‚ - ç¼ºå¤±

#### å¤©æ°”æœåŠ¡
- âŒ æ²¡æœ‰ `weather.service.ts` æˆ– `openweather.service.ts`
- âŒ å†³ç­–å±‚æœ‰ `weatherSensitivity` å­—æ®µï¼Œä½†æ²¡æœ‰å¤©æ°”æ•°æ®æº

#### èˆªç­æœåŠ¡
- âŒ æœ‰ `flight-prices/` æ¨¡å—ï¼Œä½†ä¸ç¡®å®šæ˜¯å¦æ¥å…¥ Amadeus/Skyscanner
- âŒ éœ€è¦æ£€æŸ¥æ˜¯å¦æ”¯æŒå…¨çƒèˆªç­æŸ¥è¯¢

#### é…’åº—æœåŠ¡
- âŒ æœ‰ `hotels/` æ¨¡å—ï¼Œä½†ä¸ç¡®å®šæ˜¯å¦æ¥å…¥ Booking API
- âŒ éœ€è¦æ£€æŸ¥æ˜¯å¦æ”¯æŒå…¨çƒé…’åº—æŸ¥è¯¢

#### ç­¾è¯æœåŠ¡
- âŒ æ²¡æœ‰ `visa.service.ts` æˆ– `sherpa.service.ts`
- âŒ `CountryProfile.visaForCN` æ˜¯é™æ€æ•°æ®ï¼Œä¸æ˜¯åŠ¨æ€ API

### 2. å›½å®¶/åœºæ™¯æ’ä»¶å±‚ - ç¼ºå¤±

#### è·¯å†µ/äº¤é€šçŠ¶æ€æœåŠ¡
- âŒ æ²¡æœ‰ `road-status.service.ts`
- âŒ æ²¡æœ‰å†°å²› SafeTravel / Road.is é€‚é…å™¨
- âŒ æ²¡æœ‰æ ‡å‡†çš„è·¯å†µæ•°æ®å¥‘çº¦

#### å…¬å…±äº¤é€šæœåŠ¡
- âŒ æ²¡æœ‰ `public-transport.service.ts`
- âŒ æ²¡æœ‰ç‘å£« SBB API é€‚é…å™¨
- âŒ æ²¡æœ‰æ—¥æœ¬ Navitime / Yahoo Transit é€‚é…å™¨
- âŒ æ²¡æœ‰æ ‡å‡†çš„æ—¶é—´è¡¨æ•°æ®å¥‘çº¦

#### è½®æ¸¡æœåŠ¡
- âŒ æ²¡æœ‰ `ferry.service.ts`
- âŒ æ²¡æœ‰æŒªå¨/æ™ºåˆ©è½®æ¸¡æ—¶åˆ»è¡¨é€‚é…å™¨
- âŒ Readiness å±‚æœ‰ `hasFerryTerminal` æ£€æŸ¥ï¼Œä½†æ²¡æœ‰è½®æ¸¡æ—¶åˆ»è¡¨æ•°æ®

### 3. é€‚é…å™¨æ¨¡å¼ - ç¼ºå¤±

#### æ ‡å‡†æ•°æ®å¥‘çº¦
- âŒ æ²¡æœ‰å®šä¹‰ `RoadStatus` æ¥å£
- âŒ æ²¡æœ‰å®šä¹‰ `WeatherData` æ¥å£
- âŒ æ²¡æœ‰å®šä¹‰ `TransportSchedule` æ¥å£
- âŒ æ²¡æœ‰å®šä¹‰ `FerrySchedule` æ¥å£

#### é€‚é…å™¨å®ç°
- âŒ æ²¡æœ‰ `IcelandRoadStatusAdapter`
- âŒ æ²¡æœ‰ `DefaultRoadStatusAdapter` (ä½¿ç”¨ Google Traffic)
- âŒ æ²¡æœ‰ `SwissTransportAdapter`
- âŒ æ²¡æœ‰ `JapanTransportAdapter`
- âŒ æ²¡æœ‰æŒ‰éœ€è§¦å‘æœºåˆ¶ï¼ˆæ ¹æ®ç»çº¬åº¦è‡ªåŠ¨åŠ è½½é€‚é…å™¨ï¼‰

---

## ğŸ“Š æ¶æ„å·®è·æ€»ç»“

| å±‚çº§ | ç»„ä»¶ | çŠ¶æ€ | ä¼˜å…ˆçº§ |
|------|------|------|--------|
| **å…¨çƒé€šç”¨å±‚** | å¤©æ°”æœåŠ¡ | âŒ ç¼ºå¤± | ğŸ”´ é«˜ |
| | èˆªç­æœåŠ¡ | âš ï¸ éƒ¨åˆ†å®ç° | ğŸŸ¡ ä¸­ |
| | é…’åº—æœåŠ¡ | âš ï¸ éƒ¨åˆ†å®ç° | ğŸŸ¡ ä¸­ |
| | ç­¾è¯æœåŠ¡ | âŒ ç¼ºå¤± | ğŸŸ¡ ä¸­ |
| **å›½å®¶æ’ä»¶å±‚** | è·¯å†µæœåŠ¡ | âŒ ç¼ºå¤± | ğŸ”´ é«˜ |
| | å…¬å…±äº¤é€š | âŒ ç¼ºå¤± | ğŸ”´ é«˜ |
| | è½®æ¸¡æ—¶åˆ»è¡¨ | âŒ ç¼ºå¤± | ğŸŸ¡ ä¸­ |
| **é€‚é…å™¨æ¨¡å¼** | æ ‡å‡†å¥‘çº¦ | âŒ ç¼ºå¤± | ğŸ”´ é«˜ |
| | é€‚é…å™¨å®ç° | âŒ ç¼ºå¤± | ğŸ”´ é«˜ |
| | æŒ‰éœ€è§¦å‘ | âŒ ç¼ºå¤± | ğŸ”´ é«˜ |

---

## ğŸ¯ å»ºè®®çš„æ”¹è¿›æ–¹æ¡ˆ

### Phase 1: å»ºç«‹æ ‡å‡†æ•°æ®å¥‘çº¦

åˆ›å»ºæ ‡å‡†æ¥å£å®šä¹‰ï¼š

```typescript
// src/data-contracts/interfaces/road-status.interface.ts
export interface RoadStatus {
  isOpen: boolean;
  riskLevel: 0 | 1 | 2 | 3; // 0=å®‰å…¨, 3=å±é™©
  reason?: string;
  lastUpdated: Date;
  source: string;
}

// src/data-contracts/interfaces/weather.interface.ts
export interface WeatherData {
  temperature: number;
  condition: string;
  windSpeed?: number;
  alerts?: WeatherAlert[];
  lastUpdated: Date;
  source: string;
}

// src/data-contracts/interfaces/transport-schedule.interface.ts
export interface TransportSchedule {
  route: string;
  departures: DepartureTime[];
  lastUpdated: Date;
  source: string;
}
```

### Phase 2: å®ç°é€‚é…å™¨æ¨¡å¼

```typescript
// src/data-contracts/adapters/road-status.adapter.ts
export interface RoadStatusAdapter {
  getRoadStatus(lat: number, lng: number): Promise<RoadStatus>;
}

// src/data-contracts/adapters/iceland-road-status.adapter.ts
export class IcelandRoadStatusAdapter implements RoadStatusAdapter {
  async getRoadStatus(lat: number, lng: number): Promise<RoadStatus> {
    // è°ƒç”¨ Road.is API
    // è½¬æ¢ä¸ºæ ‡å‡†æ ¼å¼
  }
}

// src/data-contracts/adapters/default-road-status.adapter.ts
export class DefaultRoadStatusAdapter implements RoadStatusAdapter {
  async getRoadStatus(lat: number, lng: number): Promise<RoadStatus> {
    // è°ƒç”¨ Google Traffic API
    // è½¬æ¢ä¸ºæ ‡å‡†æ ¼å¼
  }
}
```

### Phase 3: å®ç°æŒ‰éœ€è§¦å‘æœºåˆ¶

```typescript
// src/data-contracts/services/data-source-router.service.ts
@Injectable()
export class DataSourceRouterService {
  private adapters: Map<string, RoadStatusAdapter> = new Map();
  
  getRoadStatus(lat: number, lng: number): Promise<RoadStatus> {
    const countryCode = this.getCountryCode(lat, lng);
    const adapter = this.getAdapter(countryCode);
    return adapter.getRoadStatus(lat, lng);
  }
  
  private getAdapter(countryCode: string): RoadStatusAdapter {
    // æŒ‰å›½å®¶ä»£ç è¿”å›ç‰¹å®šé€‚é…å™¨æˆ–é»˜è®¤é€‚é…å™¨
    if (countryCode === 'IS') {
      return this.adapters.get('iceland') || new IcelandRoadStatusAdapter();
    }
    return this.adapters.get('default') || new DefaultRoadStatusAdapter();
  }
}
```

### Phase 4: å®Œå–„å…¨çƒé€šç”¨å±‚

1. **å¤©æ°”æœåŠ¡**ï¼š
   - åˆ›å»º `weather.service.ts`
   - æ¥å…¥ OpenWeather API
   - æä¾›æ ‡å‡† `WeatherData` æ¥å£

2. **èˆªç­æœåŠ¡**ï¼š
   - æ£€æŸ¥ `flight-prices/` æ¨¡å—
   - å¦‚æœªæ¥å…¥ï¼Œæ·»åŠ  Amadeus/Skyscanner æ”¯æŒ

3. **é…’åº—æœåŠ¡**ï¼š
   - æ£€æŸ¥ `hotels/` æ¨¡å—
   - å¦‚æœªæ¥å…¥ï¼Œæ·»åŠ  Booking API æ”¯æŒ

4. **ç­¾è¯æœåŠ¡**ï¼š
   - åˆ›å»º `visa.service.ts`
   - æ¥å…¥ Sherpa API
   - æä¾›åŠ¨æ€ç­¾è¯æŸ¥è¯¢

### Phase 5: å®ç°å›½å®¶ç‰¹å®šé€‚é…å™¨

æŒ‰ä¼˜å…ˆçº§å®ç°ï¼š

1. **å†°å²›**ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰ï¼š
   - `IcelandRoadStatusAdapter` - SafeTravel / Road.is
   - `IcelandWeatherAdapter` - æœ¬åœ°å¤©æ°”æº

2. **ç‘å£«**ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰ï¼š
   - `SwissTransportAdapter` - SBB API

3. **æ—¥æœ¬**ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰ï¼š
   - `JapanTransportAdapter` - Navitime / Yahoo Transit

4. **æŒªå¨/æ™ºåˆ©**ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰ï¼š
   - `NorwayFerryAdapter` - è½®æ¸¡æ—¶åˆ»è¡¨

---

## ğŸ”„ æ¼”è¿›è·¯å¾„å»ºè®®

### ç¬¬ä¸€é˜¶æ®µï¼šè·‘é€šé€šç”¨æ¨¡æ¿ âœ… éƒ¨åˆ†å®Œæˆ
- âœ… POIï¼šGoogle Places + Mapbox
- âš ï¸ å¤©æ°”ï¼šéœ€è¦æ¥å…¥ OpenWeather
- âš ï¸ èˆªç­ï¼šéœ€è¦ç¡®è®¤ Amadeus/Skyscanner
- âš ï¸ é…’åº—ï¼šéœ€è¦ç¡®è®¤ Booking API
- âŒ ç­¾è¯ï¼šéœ€è¦æ¥å…¥ Sherpa API

### ç¬¬äºŒé˜¶æ®µï¼šæ·±è€•é«˜å®¢å•ä»·åœºæ™¯ ğŸš§ è¿›è¡Œä¸­
- âœ… ä¸­å›½ï¼šé«˜å¾· POIï¼ˆå·²å®ç°ï¼‰
- âœ… æŒªå¨/å†°å²›/æ–°è¥¿å…°ï¼šOSM POI æŠ“å–ï¼ˆå·²å®ç°ï¼‰
- âŒ å†°å²›ï¼šè·¯å†µ/å¤©æ°”é€‚é…å™¨ï¼ˆç¼ºå¤±ï¼‰
- âŒ ç‘å£«ï¼šSBB é€‚é…å™¨ï¼ˆç¼ºå¤±ï¼‰
- âŒ æ—¥æœ¬ï¼šNavitime é€‚é…å™¨ï¼ˆç¼ºå¤±ï¼‰

### ç¬¬ä¸‰é˜¶æ®µï¼šé•¿å°¾è¦†ç›– â³ æœªå¼€å§‹
- å…¶ä»–å›½å®¶ç»§ç»­ä½¿ç”¨é€šç”¨æº

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³è¡ŒåŠ¨ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰

1. **åˆ›å»ºæ ‡å‡†æ•°æ®å¥‘çº¦**
   - `src/data-contracts/interfaces/` ç›®å½•
   - å®šä¹‰ `RoadStatus`, `WeatherData`, `TransportSchedule` ç­‰æ¥å£

2. **å®ç°é€‚é…å™¨åŸºç±»**
   - `src/data-contracts/adapters/` ç›®å½•
   - å®ç°é€‚é…å™¨æ¨¡å¼å’Œè·¯ç”±å™¨æœåŠ¡

3. **æ¥å…¥å¤©æ°”æœåŠ¡**
   - åˆ›å»º `weather.service.ts`
   - æ¥å…¥ OpenWeather API

4. **å®ç°å†°å²›é€‚é…å™¨**ï¼ˆä½œä¸ºè¯•ç‚¹ï¼‰
   - `IcelandRoadStatusAdapter`
   - éªŒè¯é€‚é…å™¨æ¨¡å¼çš„æœ‰æ•ˆæ€§

### ä¸­æœŸè¡ŒåŠ¨ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰

5. **å®Œå–„èˆªç­/é…’åº—æœåŠ¡**
   - æ£€æŸ¥ç°æœ‰å®ç°
   - å¦‚ç¼ºå¤±ï¼Œæ¥å…¥ Amadeus/Skyscanner/Booking

6. **å®ç°ç‘å£«/æ—¥æœ¬é€‚é…å™¨**
   - SBB API é€‚é…å™¨
   - Navitime é€‚é…å™¨

7. **å®ç°è½®æ¸¡é€‚é…å™¨**
   - æŒªå¨/æ™ºåˆ©è½®æ¸¡æ—¶åˆ»è¡¨

### é•¿æœŸè¡ŒåŠ¨ï¼ˆä½ä¼˜å…ˆçº§ï¼‰

8. **ç­¾è¯æœåŠ¡**
   - æ¥å…¥ Sherpa API

9. **æ›´å¤šå›½å®¶é€‚é…å™¨**
   - æ ¹æ®ç”¨æˆ·éœ€æ±‚é€æ­¥æ·»åŠ 

---

## ğŸ”— ç›¸å…³æ–‡ä»¶

- `src/places/services/amap-poi.service.ts` - ä¸­å›½ç‰¹å®š POI æœåŠ¡ï¼ˆå‚è€ƒå®ç°ï¼‰
- `src/trips/readiness/config/country-pack.config.ts` - å›½å®¶é…ç½®ï¼ˆå‚è€ƒå®ç°ï¼‰
- `src/trips/readiness/services/geo-facts.service.ts` - åœ°ç†ç‰¹å¾æœåŠ¡ï¼ˆå¯æ‰©å±•ï¼‰

