# Difficulty ç³»ç»Ÿï¼šå®‰å…¨ä¼˜å…ˆã€é£é™©é€æ˜ã€å¯è§£é‡Šè®¾è®¡

## ğŸ¯ æ ¸å¿ƒç«‹åœº

è¿™æ˜¯ä¸€ä¸ª**"å®‰å…¨ä¼˜å…ˆã€é£é™©é€æ˜ã€å¯è§£é‡Šã€å…è®¸ä¿å®ˆåå·®"**çš„éš¾åº¦ç³»ç»Ÿã€‚

## ğŸ“‹ äº”å¤§è®¾è®¡åŸåˆ™

### 1ï¸âƒ£ ã€Œå¯èƒ½å±é™©ã€ä¼˜å…ˆæé†’

**æ ¸å¿ƒç†è§£**ï¼š
- Difficulty = é£é™©ä¸é—¨æ§›ä¿¡å·ï¼Œ**ä¸æ˜¯"ç´¯ä¸ç´¯"çš„åŒä¹‰è¯**
- â­â­â­â­â­ æ˜¯ä¸€ç§**å¼ºè­¦å‘Š**
- é”™åˆ¤ä»£ä»·æé«˜
- **å®å¯ä¿å®ˆï¼Œä¸å¯ä¹è§‚**

**äº§å“è¡Œä¸º**ï¼š
- â­â­â­â­â­ï¼šé»˜è®¤ä¸æ¨èç»™æ–°æ‰‹
- å¼ºæç¤ºï¼šã€Œå­˜åœ¨é«˜é£é™©è·¯æ®µã€
- å¿…é¡»å±•ç¤º"ä¸ºä»€ä¹ˆ"

### 2ï¸âƒ£ åŒä¸€è·¯çº¿ï¼Œå¯¹æ–°æ‰‹ â­â­â­â­â­ï¼Œå¯¹è€æ‰‹ â­â­ æ˜¯çœŸå®å­˜åœ¨çš„

**æ ¸å¿ƒç†è§£**ï¼š
- Difficulty ä¸æ˜¯å®¢è§‚å¸¸æ•°ï¼Œè€Œæ˜¯**"äºº Ã— è·¯çº¿"çš„å…³ç³»**
- å¿…é¡»å…è®¸ Difficulty æœ‰"ä¸Šä¸‹æ–‡ç‰ˆæœ¬"ï¼Œå¦åˆ™ä¸€å®šè¯¯ä¼¤

**äº§å“è¡Œä¸º**ï¼š
- Difficulty å¿…é¡»æ”¯æŒ **Persona ä¿®æ­£**
- `effectiveDifficulty = baseDifficulty + experienceModifier`
- ç¤ºä¾‹ï¼šæ–°æ‰‹ +1 æ˜Ÿï¼Œæœ‰æŠ€æœ¯ç»éªŒ -1 æ˜Ÿ

### 3ï¸âƒ£ Difficulty ä¼šéšå­£èŠ‚å˜åŒ–

**æ ¸å¿ƒç†è§£**ï¼š
- Difficulty ä¸èƒ½åªä» POI é™æ€ metadata æ¨æ–­
- å®ƒæ˜¯ï¼š**è·¯çº¿ Ã— æ—¶é—´ Ã— æ¡ä»¶** çš„å‡½æ•°

**äº§å“è¡Œä¸º**ï¼š
- è‡³å°‘éœ€è¦ä¸€ä¸ª **Seasonal Risk Overlay**
- æ¡ä»¶ä¿®æ­£ï¼š
  - å†¬å­£ç»“å†°ï¼š+1 æ˜Ÿ
  - é›¨å­£ç¢çŸ³æ¾åŠ¨ï¼š+1 æ˜Ÿ
  - å¹²ç‡¥ç¨³å®šï¼š0

### 4ï¸âƒ£ "æŠŠéš¾è¯´å¾—ç®€å•"æ˜¯æœ€å±é™©çš„é”™è¯¯

**æ ¸å¿ƒç†è§£**ï¼š
- ç³»ç»Ÿ**å¿…é¡»åå‘ false positiveï¼ˆå¤šæŠ¥é£é™©ï¼‰**
- è€Œä¸æ˜¯ false negative

**äº§å“è¡Œä¸º**ï¼š
- â­â­â­â­â­ çš„è§¦å‘æ¡ä»¶ï¼š**å…è®¸å†—ä½™ï¼Œä¸å…è®¸é—æ¼**
- ä»»ä½•ä¸€ä¸ªã€Œé«˜é£é™©ä¿¡å·ã€+ã€Œä¸ç¡®å®šæ€§é«˜ã€ â†’ æå‡ 1 æ˜Ÿ

### 5ï¸âƒ£ æ„¿æ„è§£é‡Š"ä¸ºä»€ä¹ˆæ˜¯ â­â­â­â­â­"

**æ ¸å¿ƒç†è§£**ï¼š
- è¿½æ±‚çš„æ˜¯**å¯è§£é‡Šçš„ä¿¡ä»»ç³»ç»Ÿ**ï¼Œä¸æ˜¯é»‘ç®±è¯„åˆ†

**äº§å“è¡Œä¸º**ï¼š
- æ¯ä¸ª â­â­â­â­â­ è‡³å°‘æœ‰ 2-3 æ¡è§£é‡Šå› å­
- ä¾‹å¦‚ï¼š
  - æš´éœ²æ„Ÿå¼ºï¼ˆæ‚¬å´–è·¯æ®µï¼‰
  - å†¬å­£ç»“å†°ï¼Œå¤±è¶³é£é™©é«˜
  - ç¤¾åŒºå¤šæ¬¡æŠ¥å‘Šéœ€æŠ€æœ¯è£…å¤‡

---

## ğŸ¯ Difficulty çš„æœ€ç»ˆå®šä¹‰

**Trail Difficultyï¼ˆâ­â­â­â­â­ï¼‰ä¸æ˜¯ä½“åŠ›æ¶ˆè€—ï¼Œè€Œæ˜¯ï¼š**

> ã€Œåœ¨å½“å‰æ¡ä»¶ä¸‹ï¼Œä¸€ä¸ª**ç›®æ ‡äººç¾¤**æ˜¯å¦å¯èƒ½é­é‡**è¶…å‡ºé¢„æœŸçš„é£é™©æˆ–æŠ€æœ¯é—¨æ§›**ã€

### å…¬å¼

```
Difficulty = é£é™© Ã— æŠ€æœ¯ Ã— ä¸å¯é€†æ€§
```

### ä¸æ˜¯

- âŒ æ—¶é—´
- âŒ ç´¯ä¸ç´¯
- âŒ èµ°å¤šä¹…

---

## ğŸ“Š Difficulty æ¨¡å‹ï¼ˆæ˜ç¡®ç‰ˆï¼‰

### â‘  æ ¸å¿ƒè¾“å…¥ï¼ˆåªå…è®¸è¿™äº›è¿›å…¥ Difficultyï¼‰

| ç»´åº¦ | æ˜¯å¦å…è®¸ | è¯´æ˜ |
|------|---------|------|
| **æŠ€æœ¯åŠ¨ä½œ**ï¼ˆscramble / rope / exposureï¼‰ | âœ… | æ ¸å¿ƒ |
| **åœ°å½¢ä¸å¯é€†**ï¼ˆé™¡å´– / å†°é›ª / ç¢çŸ³ï¼‰ | âœ… | æ ¸å¿ƒ |
| **å­£èŠ‚é£é™©**ï¼ˆé›ª / å†° / èæ°´ï¼‰ | âœ… | æ ¸å¿ƒ |
| **å®˜æ–¹/ä¸“ä¸šå¹³å°éš¾åº¦** | âœ… | å‚è€ƒ |
| **ç¤¾åŒºé£é™©å…³é”®è¯** | âœ… | æ ¡æ­£ |
| **è·ç¦» / æ—¶é•¿** | âŒ | **ç¦æ­¢** |
| **ç´¯è®¡çˆ¬å‡** | âŒ | **ç¦æ­¢** |

ğŸ‘‰ **è¿™æ˜¯ä¸€ä¸ªéå¸¸é‡è¦çš„"æ’é™¤è¡¨"**  
å®ƒä¼šè®©ä½ çš„ç³»ç»Ÿå’Œ 80% çš„"ä¼ªéš¾åº¦"äº§å“æ‹‰å¼€å·®è·ã€‚

### â‘¡ Difficulty æ˜Ÿçº§çš„çœŸå®è¯­ä¹‰ï¼ˆç³»ç»Ÿå†…éƒ¨å®šä¹‰ï¼‰

| æ˜Ÿçº§ | å«ä¹‰ï¼ˆç»™ç³»ç»Ÿç”¨ï¼‰ |
|------|----------------|
| â­ | å‡ ä¹æ— é£é™©ï¼Œæ–°æ‰‹å¯éšæ—¶æ’¤é€€ |
| â­â­ | æœ‰åœ°å½¢å˜åŒ–ï¼Œä½†ç›´è§‰å¯åº”å¯¹ |
| â­â­â­ | éœ€è¦ç»éªŒåˆ¤æ–­ï¼Œé”™è¯¯ä¼šä¸èˆ’æœ |
| â­â­â­â­ | éœ€è¦æŠ€æœ¯/ç»éªŒï¼Œé”™è¯¯å¯èƒ½å—ä¼¤ |
| â­â­â­â­â­ | é”™è¯¯å¯èƒ½å¯¼è‡´ä¸¥é‡åæœï¼ˆfall / lost / exposureï¼‰ |

âš ï¸ **æ³¨æ„**ï¼š

â­â­â­â­â­ ä¸æ˜¯"å¾ˆç´¯"ï¼Œè€Œæ˜¯ï¼š

> ã€Œä½ ä¸€æ—¦åˆ¤æ–­é”™ï¼Œå¾ˆéš¾é ä½“åŠ›è¡¥æ•‘ã€

---

## ğŸ”§ å®ç°ç­–ç•¥

### ç­–ç•¥ä¸€ï¼šé£é™©é—¨ç¦æ¨¡å‹ï¼ˆæœ€æ¨èï¼‰â­

**å®ç°**ï¼š
- â­â­â­â­â­ ä¸æ˜¯ç®—å‡ºæ¥çš„ï¼Œè€Œæ˜¯**è¢«è§¦å‘çš„**
- ä»»ä¸€é«˜é£é™© + æ— æ˜æ˜¾ç¼“å†² â†’ â­â­â­â­â­

**ä¼˜ç‚¹**ï¼šå®‰å…¨ã€æ¸…æ™°ã€å¥½è§£é‡Š

**ä»£ç ç¤ºä¾‹**ï¼š
```typescript
// é«˜é£é™©ä¿¡å·è§¦å‘æ£€æŸ¥
if (hasHighRisk && !metadata.trailDifficulty && riskFactors.length >= 2) {
  return {
    level: DIFFICULTY_LEVEL.EXTREME,  // ä¿å®ˆï¼šç›´æ¥æå‡åˆ°æœ€é«˜
    riskFactors,
    requiresEquipment: true,
    explanations: [
      `æ£€æµ‹åˆ° ${riskFactors.length} ä¸ªé«˜é£é™©ä¿¡å·ï¼š${riskFactors.join('ã€')}`,
      'å­˜åœ¨æŠ€æœ¯é—¨æ§›æˆ–ä¸å¯é€†åœ°å½¢é£é™©',
    ],
  };
}
```

### ç­–ç•¥äºŒï¼šPersona åˆ†å±‚ Difficulty

**å®ç°**ï¼š
- åŒä¸€è·¯çº¿å­˜ `baseDifficulty`
- ä½†å±•ç¤ºçš„æ˜¯ `effectiveDifficulty`

**ä¼˜ç‚¹**ï¼šçœŸå®ã€ä¸æ¬ºéª—æ–°æ‰‹

**ä»£ç ç¤ºä¾‹**ï¼š
```typescript
// ç”¨æˆ·ç»éªŒä¿®æ­£
const experienceModifier = {
  beginner: +1,      // æ–°æ‰‹ï¼š+1 æ˜Ÿï¼ˆæ›´ä¿å®ˆï¼‰
  intermediate: 0,   // ä¸­çº§ï¼šä¸å˜
  advanced: -0.5,    // é«˜çº§ï¼š-0.5 æ˜Ÿ
  expert: -1,        // ä¸“å®¶ï¼š-1 æ˜Ÿ
};

effectiveDifficulty = baseDifficulty + experienceModifier[userExperience];
```

### ç­–ç•¥ä¸‰ï¼šå­£èŠ‚ Overlay

**å®ç°**ï¼š
- ä¸æ”¹ POI æœ¬ä½“ï¼Œåªåœ¨è¿è¡Œæ—¶å åŠ 

**ä¼˜ç‚¹**ï¼šé¿å…æ•°æ®æ±¡æŸ“

**ä»£ç ç¤ºä¾‹**ï¼š
```typescript
// å­£èŠ‚ä¿®æ­£
if (season === 'winter' && hasIceRisk) {
  seasonalModifier = {
    season: 'winter',
    modifier: +1,  // å†¬å­£ç»“å†°ï¼š+1 æ˜Ÿ
    reason: 'å†¬å­£ç»“å†°ï¼Œå¤±è¶³é£é™©é«˜',
  };
}
```

### ç­–ç•¥å››ï¼šè§£é‡Šä¼˜å…ˆè®¾è®¡

**å®ç°**ï¼š
- å…ˆå†™"è§£é‡Šæ¨¡æ¿"ï¼Œå†å†™è§„åˆ™

**ä¼˜ç‚¹**ï¼šé˜²æ­¢é»‘ç®±

**ä»£ç ç¤ºä¾‹**ï¼š
```typescript
// ç”Ÿæˆè§£é‡Šå› å­
explanations = [
  `${semantics.stars} ${semantics.meaning}`,
  `é£é™©å› ç´ ï¼š${riskDescriptions}`,
  requiresEquipment ? 'éœ€è¦ä¸“ä¸šè£…å¤‡' : '',
  requiresGuide ? 'å»ºè®®å‘å¯¼é™ªåŒ' : '',
  seasonalModifier ? `å­£èŠ‚ä¿®æ­£ï¼š${seasonalModifier.reason}` : '',
];
```

---

## ğŸ“ äº§å“è¡Œä¸ºæ˜ å°„

### 1ï¸âƒ£ ã€Œå¯èƒ½å±é™©ã€â†’ UI & é€»è¾‘è¡Œä¸º

**â­â­â­â­â­ çš„å¤„ç†**ï¼š

```typescript
if (difficulty.level === 'EXTREME') {
  // é»˜è®¤ä¸æ¨èç»™æ–°æ‰‹
  if (userExperience === 'beginner') {
    return {
      recommended: false,
      warning: 'å­˜åœ¨é«˜é£é™©è·¯æ®µ',
      explanations: difficulty.explanations,
    };
  }
  
  // å¼ºæç¤º
  return {
    recommended: true,
    warning: 'âš ï¸ é«˜é£é™©ï¼šå­˜åœ¨æŠ€æœ¯é—¨æ§›æˆ–ä¸å¯é€†åœ°å½¢é£é™©',
    explanations: difficulty.explanations,
    requiresEquipment: true,
    requiresGuide: difficulty.requiresGuide,
  };
}
```

### 2ï¸âƒ£ ã€ŒåŒä¸€è·¯çº¿ï¼Œä¸åŒäººä¸åŒæ˜Ÿã€

**Persona ä¿®æ­£**ï¼š

```typescript
const baseDifficulty = assessBase(metadata);
const effectiveDifficulty = applyExperienceModifier(
  baseDifficulty,
  userExperience
);

// å±•ç¤ºç»™ç”¨æˆ·
displayDifficulty(effectiveDifficulty, {
  showBase: true,  // æ˜¾ç¤ºåŸºç¡€éš¾åº¦
  showEffective: true,  // æ˜¾ç¤ºæœ‰æ•ˆéš¾åº¦
  showReason: true,  // æ˜¾ç¤ºä¿®æ­£åŸå› 
});
```

### 3ï¸âƒ£ ã€Œå­£èŠ‚å˜åŒ–ã€

**Seasonal Overlay**ï¼š

```typescript
const baseDifficulty = assessBase(metadata);
const seasonalModifier = getSeasonalModifier(baseDifficulty, currentSeason);

if (seasonalModifier) {
  const adjustedDifficulty = applyModifier(baseDifficulty, seasonalModifier);
  
  // å±•ç¤º
  displayDifficulty(adjustedDifficulty, {
    showSeasonalWarning: true,
    seasonalReason: seasonalModifier.reason,
  });
}
```

### 4ï¸âƒ£ ã€Œå®å¯ä¿å®ˆã€

**False Positive åå‘**ï¼š

```typescript
// é«˜é£é™©ä¿¡å·è§¦å‘ï¼ˆå…è®¸å†—ä½™ï¼Œä¸å…è®¸é—æ¼ï¼‰
if (hasHighRisk && uncertaintyHigh) {
  // ç›´æ¥æå‡åˆ°æœ€é«˜
  level = DIFFICULTY_LEVEL.EXTREME;
  explanations.push('æ£€æµ‹åˆ°é«˜é£é™©ä¿¡å·ï¼Œä¿å®ˆè¯„ä¼°');
}
```

### 5ï¸âƒ£ ã€Œæ„¿æ„è§£é‡Šã€

**è§£é‡Šå› å­ç”Ÿæˆ**ï¼š

```typescript
const explanations = generateExplanations(difficulty);
// [
//   'â­â­â­â­ éœ€è¦æŠ€æœ¯/ç»éªŒï¼Œé”™è¯¯å¯èƒ½å—ä¼¤',
//   'é£é™©å› ç´ ï¼šæš´éœ²æ„Ÿå¼ºï¼ˆæ‚¬å´–è·¯æ®µï¼‰ã€éœ€è¦ç»³ç´¢',
//   'éœ€è¦ä¸“ä¸šè£…å¤‡',
//   'å»ºè®®å‘å¯¼é™ªåŒ',
//   'å­£èŠ‚ä¿®æ­£ï¼šå†¬å­£ç»“å†°ï¼Œå¤±è¶³é£é™©é«˜',
// ]
```

---

## ğŸš¨ ç¦æ­¢è¿›å…¥ Difficulty çš„ä¿¡å·

### âŒ ç¦æ­¢åˆ—è¡¨

- **è·ç¦»**ï¼ˆkmï¼‰
- **æ—¶é•¿**ï¼ˆå°æ—¶ï¼‰
- **ç´¯è®¡çˆ¬å‡**ï¼ˆmï¼‰
- **ä½“åŠ›æ¶ˆè€—**ï¼ˆfatigue scoreï¼‰
- **å¹³å‡å¡åº¦**ï¼ˆè¿™äº›å±äº Fatigue Trackï¼‰

### âœ… å…è®¸åˆ—è¡¨

- **æŠ€æœ¯åŠ¨ä½œ**ï¼šscramble, rope, exposure
- **åœ°å½¢ä¸å¯é€†**ï¼šcliff, ice, loose_rock
- **å­£èŠ‚é£é™©**ï¼šwinter_ice, rain_loose, snow
- **å®˜æ–¹è¯„çº§**ï¼šAllTrails, Komoot
- **ç¤¾åŒºé£é™©å…³é”®è¯**ï¼šä»æ¸¸è®°ä¸­æå–

---

## ğŸ“Š æ¡ˆä¾‹å¯¹ç…§

| åœºæ™¯ | Difficulty | Fatigue | è§£é‡Š |
|------|-----------|---------|------|
| å†°å·çŸ­çº¿ | â­â­â­â­â­ | 6 | æŠ€æœ¯é«˜ã€æ—¶é—´çŸ­ |
| 8h ç¼“å¡ | â­â­ | 8 | ç´¯ä½†ä¸éš¾ |
| ç«å±±è§‚æ™¯ | â­â­â­â­ | 4 | å¿ƒç†ä¸åœ°å½¢ |
| åŸå¸‚çˆ¬æ¥¼ | â­ | 7 | ç´¯ä½†æ— é—¨æ§› |
| å†¬å­£ç»“å†°è·¯çº¿ | â­â­â­â­â­ | 5 | å­£èŠ‚é£é™©æå‡éš¾åº¦ |

---

## ğŸ” é—®é¢˜åˆ†æè¡¨æ ¼

| æ¨¡å— | å†…å®¹ |
|------|------|
| **å˜é‡åˆ†è§£ï¼ˆH / Eï¼‰** | Hï¼ˆäººï¼‰ï¼šç»éªŒã€æŠ€æœ¯ã€å¿ƒç†æ‰¿å—ï¼›Eï¼ˆç¯å¢ƒï¼‰ï¼šæš´éœ²ã€ä¸å¯é€†åœ°å½¢ã€å­£èŠ‚é£é™© |
| **ç ”ç©¶é—®é¢˜** | 1) ä»€ä¹ˆæ¡ä»¶ä¸‹å¿…é¡»ä¸Šè°ƒåˆ° â­â­â­â­â­ï¼Ÿ<br>2) å“ªäº›å˜é‡ä¸¥ç¦è¿›å…¥ Difficultyï¼Ÿ<br>3) å¦‚ä½•åœ¨ä¿å®ˆä¸å¯ä¿¡ä¹‹é—´å¹³è¡¡ï¼Ÿ |

---

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€è¯„ä¼°

```typescript
import { TrailDifficultyAssessor } from './utils/trail-difficulty-assessor.util';

const difficulty = TrailDifficultyAssessor.assess(place.metadata);
// {
//   level: 'EXTREME',
//   riskFactors: ['exposure', 'rope', 'ice'],
//   requiresEquipment: true,
//   requiresGuide: true,
//   explanations: [
//     'â­â­â­â­ éœ€è¦æŠ€æœ¯/ç»éªŒï¼Œé”™è¯¯å¯èƒ½å—ä¼¤',
//     'é£é™©å› ç´ ï¼šæš´éœ²æ„Ÿå¼ºï¼ˆæ‚¬å´–è·¯æ®µï¼‰ã€éœ€è¦ç»³ç´¢ã€å†°é›ª',
//     'éœ€è¦ä¸“ä¸šè£…å¤‡',
//     'å»ºè®®å‘å¯¼é™ªåŒ',
//   ],
// }
```

### å¸¦ Persona ä¿®æ­£

```typescript
const difficulty = TrailDifficultyAssessor.assess(place.metadata, {
  userExperience: 'beginner',  // æ–°æ‰‹
});
// {
//   level: 'EXTREME',  // åŸºç¡€æ˜¯ HARDï¼Œæ–°æ‰‹ +1 æ˜Ÿ
//   explanations: [
//     '...',
//     'æ–°æ‰‹ç”¨æˆ·ï¼šéš¾åº¦æå‡ 1 æ˜Ÿï¼ˆæ›´ä¿å®ˆï¼‰',
//   ],
// }
```

### å¸¦å­£èŠ‚ä¿®æ­£

```typescript
const difficulty = TrailDifficultyAssessor.assess(place.metadata, {
  season: 'winter',  // å†¬å­£
});
// {
//   level: 'EXTREME',  // åŸºç¡€æ˜¯ HARDï¼Œå†¬å­£ +1 æ˜Ÿ
//   seasonalModifier: {
//     season: 'winter',
//     modifier: +1,
//     reason: 'å†¬å­£ç»“å†°ï¼Œå¤±è¶³é£é™©é«˜',
//   },
//   explanations: [
//     '...',
//     'å­£èŠ‚ä¿®æ­£ï¼šå†¬å­£ç»“å†°ï¼Œå¤±è¶³é£é™©é«˜',
//   ],
// }
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [`docs/DIFFICULTY-VS-FATIGUE-ARCHITECTURE.md`](./DIFFICULTY-VS-FATIGUE-ARCHITECTURE.md) - åˆ†è½¨é“æ¶æ„
- [`docs/DIFFICULTY-FATIGUE-REFACTOR-SUMMARY.md`](./DIFFICULTY-FATIGUE-REFACTOR-SUMMARY.md) - é‡æ„æ€»ç»“
- [`src/places/interfaces/trail-difficulty.interface.ts`](../src/places/interfaces/trail-difficulty.interface.ts) - æ¥å£å®šä¹‰
- [`src/places/utils/trail-difficulty-assessor.util.ts`](../src/places/utils/trail-difficulty-assessor.util.ts) - è¯„ä¼°å™¨å®ç°
