# é¡¹ç›®ç»“æ„è¯´æ˜

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜é¡¹ç›®çš„ç›®å½•ç»“æ„å’Œæ¯ä¸ªæ–‡ä»¶/ç›®å½•çš„ä½œç”¨ã€‚

## ğŸ“ é¡¹ç›®æ ¹ç›®å½•

```
project/
â”œâ”€â”€ .cursor/                    # Cursor IDE é…ç½®æ–‡ä»¶
â”œâ”€â”€ .env.example.mapbox        # Mapbox API é…ç½®ç¤ºä¾‹
â”œâ”€â”€ .gitignore                 # Git å¿½ç•¥æ–‡ä»¶é…ç½®
â”œâ”€â”€ check-iceland-data.ts      # æ£€æŸ¥å†°å²›æ•°æ®çš„è„šæœ¬
â”œâ”€â”€ data/                      # æ•°æ®æ–‡ä»¶ç›®å½•
â”œâ”€â”€ docs/                      # æ–‡æ¡£ç›®å½•
â”œâ”€â”€ extract-urls.js            # URL æå–å·¥å…·è„šæœ¬
â”œâ”€â”€ models/                    # Python æ¨¡å‹æ–‡ä»¶ï¼ˆè·¯çº¿éš¾åº¦è¯„ä¼°ï¼‰
â”œâ”€â”€ nest-cli.json              # NestJS CLI é…ç½®æ–‡ä»¶
â”œâ”€â”€ next-env.d.ts              # Next.js ç±»å‹å®šä¹‰
â”œâ”€â”€ next.config.mjs            # Next.js é…ç½®æ–‡ä»¶
â”œâ”€â”€ package.json               # Node.js é¡¹ç›®ä¾èµ–å’Œè„šæœ¬
â”œâ”€â”€ package-lock.json          # npm ä¾èµ–é”å®šæ–‡ä»¶
â”œâ”€â”€ pnpm-lock.yaml             # pnpm ä¾èµ–é”å®šæ–‡ä»¶
â”œâ”€â”€ prisma/                    # Prisma ORM é…ç½®å’Œè¿ç§»
â”œâ”€â”€ prisma.config.ts           # Prisma é…ç½®æ–‡ä»¶
â”œâ”€â”€ public/                    # Next.js é™æ€èµ„æºç›®å½•
â”œâ”€â”€ README.md                  # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ requirements.txt           # Python ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ scripts/                   # æ•°æ®å¯¼å…¥å’Œå¤„ç†è„šæœ¬
â”œâ”€â”€ src/                       # æºä»£ç ç›®å½•ï¼ˆä¸»è¦ä¸šåŠ¡é€»è¾‘ï¼‰
â”œâ”€â”€ tools/                     # æµ‹è¯•å’Œå·¥å…·è„šæœ¬
â”œâ”€â”€ tsconfig.json              # TypeScript é…ç½®æ–‡ä»¶ï¼ˆNext.jsï¼‰
â””â”€â”€ tsconfig.backend.json      # TypeScript é…ç½®æ–‡ä»¶ï¼ˆåç«¯ï¼‰
```

---

## ğŸ“‚ ä¸»è¦ç›®å½•è¯¦è§£

### 1. `/src` - æºä»£ç ç›®å½•ï¼ˆæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼‰

è¿™æ˜¯ NestJS åç«¯åº”ç”¨çš„ä¸»è¦ä»£ç ç›®å½•ï¼Œé‡‡ç”¨æ¨¡å—åŒ–æ¶æ„ã€‚

#### 1.1 `/src/app.module.ts`
- **ä½œç”¨**: NestJS åº”ç”¨çš„æ ¹æ¨¡å—ï¼Œæ³¨å†Œæ‰€æœ‰åŠŸèƒ½æ¨¡å—
- **å†…å®¹**: å¯¼å…¥æ‰€æœ‰å­æ¨¡å—ï¼ˆPlacesModule, TripsModule, TransportModule ç­‰ï¼‰

#### 1.2 `/src/main.ts`
- **ä½œç”¨**: åº”ç”¨å…¥å£æ–‡ä»¶ï¼Œå¯åŠ¨ NestJS æœåŠ¡å™¨
- **åŠŸèƒ½**: 
  - é…ç½®å…¨å±€éªŒè¯ç®¡é“
  - å¯ç”¨ CORS
  - é…ç½® Swagger API æ–‡æ¡£
  - å¯åŠ¨ HTTP æœåŠ¡å™¨ï¼ˆé»˜è®¤ 3000 ç«¯å£ï¼‰

#### 1.3 `/src/app/` - Next.js å‰ç«¯åº”ç”¨
- **ä½œç”¨**: Next.js 14 å‰ç«¯åº”ç”¨ä»£ç 
- **æ–‡ä»¶**:
  - `*.tsx`: React ç»„ä»¶
  - `*.css`: æ ·å¼æ–‡ä»¶
  - `*.ico`: å›¾æ ‡æ–‡ä»¶

---

### 2. æ ¸å¿ƒä¸šåŠ¡æ¨¡å—

#### 2.1 `/src/trips/` - è¡Œç¨‹ç®¡ç†æ¨¡å—
- **ä½œç”¨**: ç®¡ç†ç”¨æˆ·è¡Œç¨‹ï¼ˆTripï¼‰çš„åˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°
- **æ–‡ä»¶**:
  - `trips.controller.ts`: è¡Œç¨‹ API æ§åˆ¶å™¨
  - `trips.service.ts`: è¡Œç¨‹ä¸šåŠ¡é€»è¾‘
  - `trips.module.ts`: æ¨¡å—å®šä¹‰
  - `dto/`: æ•°æ®ä¼ è¾“å¯¹è±¡ï¼ˆåˆ›å»º/æ›´æ–°è¡Œç¨‹ï¼‰
  - `entities/`: å®ä½“å®šä¹‰
  - `interfaces/`: æ¥å£å®šä¹‰ï¼ˆèŠ‚å¥é…ç½®ç­‰ï¼‰
  - `services/`: å­æœåŠ¡ï¼ˆæœºç¥¨ä»·æ ¼ç›¸å…³ï¼‰
  - `utils/`: å·¥å…·å‡½æ•°ï¼ˆä½“åŠ›æ¨¡æ‹Ÿå™¨ã€èŠ‚å¥è®¡ç®—å™¨ï¼‰

**æ ¸å¿ƒåŠŸèƒ½**:
- åˆ›å»ºè¡Œç¨‹æ—¶è‡ªåŠ¨è®¡ç®—é¢„ç®—åˆ‡åˆ†å’ŒèŠ‚å¥ç­–ç•¥
- æ ¹æ®ç”¨æˆ·ç”»åƒï¼ˆä½“åŠ›ã€åœ°å½¢é™åˆ¶ï¼‰ç”Ÿæˆ pacingConfig
- æœºç¥¨ä»·æ ¼ä¼°ç®—æœåŠ¡

---

#### 2.2 `/src/places/` - åœ°ç‚¹ç®¡ç†æ¨¡å—
- **ä½œç”¨**: ç®¡ç†åœ°ç‚¹ï¼ˆPlaceï¼‰æ•°æ®ï¼ŒåŒ…æ‹¬æ™¯ç‚¹ã€é¤å…ã€é…’åº—ç­‰
- **æ–‡ä»¶**:
  - `places.controller.ts`: åœ°ç‚¹ API æ§åˆ¶å™¨ï¼ˆ10+ ä¸ªæ¥å£ï¼‰
  - `places.service.ts`: åœ°ç‚¹ä¸šåŠ¡é€»è¾‘
  - `places.module.ts`: æ¨¡å—å®šä¹‰
  - `dto/`: æ•°æ®ä¼ è¾“å¯¹è±¡
  - `interfaces/`: æ¥å£å®šä¹‰ï¼ˆæ™¯ç‚¹å…ƒæ•°æ®ã€ç‰©ç†å…ƒæ•°æ®ç­‰ï¼‰
  - `services/`: å­æœåŠ¡
    - `amap-poi.service.ts`: é«˜å¾·åœ°å›¾ POI æœåŠ¡
    - `google-places.service.ts`: Google Places API æœåŠ¡
    - `hotel-recommendation.service.ts`: é…’åº—æ¨èæœåŠ¡
    - `mapbox.service.ts`: Mapbox åœ°å›¾æœåŠ¡
    - `nature-poi.service.ts`: è‡ªç„¶ POI æœåŠ¡
    - `nara-hint.service.ts`: NARA æç¤ºç”ŸæˆæœåŠ¡
    - `nature-poi-mapper.service.ts`: è‡ªç„¶ POI æ˜ å°„æœåŠ¡
    - `overpass.service.ts`: Overpass API æœåŠ¡ï¼ˆOSM æ•°æ®ï¼‰
    - `route-difficulty.service.ts`: è·¯çº¿éš¾åº¦è¯„ä¼°æœåŠ¡
  - `utils/`: å·¥å…·å‡½æ•°
    - `geojson-validator.util.ts`: GeoJSON éªŒè¯
    - `gpx-parser.util.ts`: GPX æ–‡ä»¶è§£æ
    - `gpx-fatigue-calculator.util.ts`: GPX ç–²åŠ³è®¡ç®—
    - `physical-metadata-generator.util.ts`: ç‰©ç†å…ƒæ•°æ®ç”Ÿæˆ
    - `trail-difficulty-assessor.util.ts`: è·¯çº¿éš¾åº¦è¯„ä¼°

**æ ¸å¿ƒåŠŸèƒ½**:
- é™„è¿‘åœ°ç‚¹æŸ¥è¯¢ï¼ˆåŸºäº PostGISï¼‰
- é…’åº—æ¨èï¼ˆç»¼åˆéšå½¢æˆæœ¬ï¼‰
- è·¯çº¿éš¾åº¦è®¡ç®—
- è‡ªç„¶ POI ç®¡ç†
- æ™¯ç‚¹ä¿¡æ¯ä¸°å¯ŒåŒ–ï¼ˆä»é«˜å¾·åœ°å›¾è·å–ï¼‰

---

#### 2.3 `/src/itinerary-items/` - è¡Œç¨‹é¡¹ç®¡ç†æ¨¡å—
- **ä½œç”¨**: ç®¡ç†è¡Œç¨‹é¡¹ï¼ˆItineraryItemï¼‰ï¼ŒåŒ…æ‹¬æ´»åŠ¨ã€ç”¨é¤ã€ä¼‘æ¯ã€äº¤é€šç­‰
- **æ–‡ä»¶**:
  - `itinerary-items.controller.ts`: è¡Œç¨‹é¡¹ API æ§åˆ¶å™¨
  - `itinerary-items.service.ts`: è¡Œç¨‹é¡¹ä¸šåŠ¡é€»è¾‘
  - `itinerary-items.module.ts`: æ¨¡å—å®šä¹‰
  - `dto/`: åˆ›å»º/æ›´æ–°è¡Œç¨‹é¡¹çš„æ•°æ®ä¼ è¾“å¯¹è±¡
  - `entities/`: å®ä½“å®šä¹‰

**æ ¸å¿ƒåŠŸèƒ½**:
- CRUD æ“ä½œ
- è‡ªåŠ¨æ ¡éªŒè¥ä¸šæ—¶é—´å’Œæ—¶é—´é€»è¾‘

---

#### 2.4 `/src/itinerary-optimization/` - è·¯çº¿ä¼˜åŒ–æ¨¡å—
- **ä½œç”¨**: ä½¿ç”¨èŠ‚å¥æ„Ÿç®—æ³•ä¼˜åŒ–è·¯çº¿
- **æ–‡ä»¶**:
  - `itinerary-optimization.controller.ts`: è·¯çº¿ä¼˜åŒ– API æ§åˆ¶å™¨
  - `itinerary-optimization.service.ts`: è·¯çº¿ä¼˜åŒ–ä¸šåŠ¡é€»è¾‘
  - `services/`:
    - `route-optimizer.service.ts`: è·¯çº¿ä¼˜åŒ–å™¨ï¼ˆæ¨¡æ‹Ÿé€€ç«ç®—æ³•ï¼‰
    - `spatial-clustering.service.ts`: ç©ºé—´èšç±»æœåŠ¡
    - `happiness-scorer.service.ts`: å¿«ä¹å€¼è¯„åˆ†æœåŠ¡
  - `dto/`: ä¼˜åŒ–è¯·æ±‚çš„æ•°æ®ä¼ è¾“å¯¹è±¡
  - `interfaces/`: æ¥å£å®šä¹‰

**æ ¸å¿ƒåŠŸèƒ½**:
- 4 ç»´å¹³è¡¡ç®—æ³•ï¼š
  1. ç©ºé—´èšç±»ï¼ˆæ‹’ç»"æŠ˜è¿”è·‘"ï¼‰
  2. èŠ‚å¥æ§åˆ¶ï¼ˆå¼ºåº¦äº¤æ›¿ï¼‰
  3. ç”Ÿç‰©é’Ÿé”šå®šï¼ˆé¥­ç‚¹ä¼˜å…ˆï¼‰
  4. å®¹é”™ä¸ç•™ç™½ï¼ˆå¼¹æ€§å› å­ï¼‰

---

#### 2.5 `/src/transport/` - äº¤é€šè§„åˆ’æ¨¡å—
- **ä½œç”¨**: æ™ºèƒ½äº¤é€šè·¯çº¿è§„åˆ’
- **æ–‡ä»¶**:
  - `transport.controller.ts`: äº¤é€šè§„åˆ’ API æ§åˆ¶å™¨
  - `transport-routing.service.ts`: äº¤é€šè·¯çº¿æœåŠ¡
  - `transport-decision.service.ts`: äº¤é€šå†³ç­–æœåŠ¡
  - `services/`:
    - `amap-routes.service.ts`: é«˜å¾·åœ°å›¾è·¯çº¿æœåŠ¡
    - `google-routes.service.ts`: Google è·¯çº¿æœåŠ¡
    - `smart-routes.service.ts`: æ™ºèƒ½è·¯çº¿æœåŠ¡
    - `location-detector.service.ts`: ä½ç½®æ£€æµ‹æœåŠ¡
    - `route-cache.service.ts`: è·¯çº¿ç¼“å­˜æœåŠ¡
  - `interfaces/`: æ¥å£å®šä¹‰ï¼ˆç”¨æˆ·ä¸Šä¸‹æ–‡ç­‰ï¼‰
  - `dto/`: æ•°æ®ä¼ è¾“å¯¹è±¡

**æ ¸å¿ƒåŠŸèƒ½**:
- è‡ªåŠ¨åŒºåˆ†å¤§äº¤é€šï¼ˆåŸå¸‚é—´ï¼‰å’Œå°äº¤é€šï¼ˆå¸‚å†…ï¼‰
- æ ¹æ®ç”¨æˆ·ç”»åƒï¼ˆè¡Œæã€è€äººã€å¤©æ°”ï¼‰æ™ºèƒ½æ’åº
- è®¡ç®—"ç—›è‹¦æŒ‡æ•°"ï¼Œæ¨èæœ€èˆ’é€‚çš„æ–¹æ¡ˆ

---

#### 2.6 `/src/flight-prices/` - æœºç¥¨ä»·æ ¼æ¨¡å—
- **ä½œç”¨**: æœºç¥¨ä»·æ ¼å‚è€ƒæ•°æ®ç®¡ç†
- **æ–‡ä»¶**:
  - `flight-prices.controller.ts`: æœºç¥¨ä»·æ ¼ API æ§åˆ¶å™¨
  - `dto/`: æ•°æ®ä¼ è¾“å¯¹è±¡

**æ ¸å¿ƒåŠŸèƒ½**:
- ä¼°ç®—æœºç¥¨+ç­¾è¯æˆæœ¬
- å›½å†…èˆªçº¿ä»·æ ¼ä¼°ç®—ï¼ˆåŸºäºå†å²æ•°æ®ï¼‰
- ä»·æ ¼è¶‹åŠ¿æŸ¥è¯¢

---

#### 2.7 `/src/hotels/` - é…’åº—ä»·æ ¼æ¨¡å—
- **ä½œç”¨**: é…’åº—ä»·æ ¼ä¼°ç®—å’Œæ¨è
- **æ–‡ä»¶**:
  - `hotels.controller.ts`: é…’åº—ä»·æ ¼ API æ§åˆ¶å™¨
  - `services/hotel-price.service.ts`: é…’åº—ä»·æ ¼æœåŠ¡

**æ ¸å¿ƒåŠŸèƒ½**:
- æ ¹æ®åŸå¸‚ã€æ˜Ÿçº§ä¼°ç®—ä»·æ ¼
- å­£åº¦ä»·æ ¼è¶‹åŠ¿
- é…’åº—æ¨è

---

#### 2.8 `/src/countries/` - å›½å®¶æ¡£æ¡ˆæ¨¡å—
- **ä½œç”¨**: ç®¡ç†å›½å®¶æ¡£æ¡ˆä¿¡æ¯ï¼ˆè´§å¸ã€æ”¯ä»˜ã€ç­¾è¯ç­‰ï¼‰
- **æ–‡ä»¶**:
  - `countries.controller.ts`: å›½å®¶æ¡£æ¡ˆ API æ§åˆ¶å™¨
  - `countries.service.ts`: å›½å®¶æ¡£æ¡ˆä¸šåŠ¡é€»è¾‘
  - `dto/`: æ•°æ®ä¼ è¾“å¯¹è±¡ï¼ˆè´§å¸ç­–ç•¥ç­‰ï¼‰

**æ ¸å¿ƒåŠŸèƒ½**:
- è·å–å›½å®¶åˆ—è¡¨
- è·å–è´§å¸ç­–ç•¥ï¼ˆæ±‡ç‡ã€æ”¯ä»˜æ–¹å¼ã€é€Ÿç®—å£è¯€ï¼‰

---

#### 2.9 `/src/planning-policy/` - è§„åˆ’ç­–ç•¥æ¨¡å—ï¼ˆWhat-Ifï¼‰
- **ä½œç”¨**: è¡Œç¨‹è®¡åˆ’çš„ç¨³å¥åº¦è¯„ä¼°å’Œ What-If åˆ†æ
- **æ–‡ä»¶**:
  - `planning-policy.controller.ts`: è§„åˆ’ç­–ç•¥ API æ§åˆ¶å™¨
  - `services/`:
    - `robustness-evaluator.service.ts`: ç¨³å¥åº¦è¯„ä¼°æœåŠ¡
    - `day-scheduler.service.ts`: æ—¥ç¨‹è°ƒåº¦æœåŠ¡
    - `hp-simulator.service.ts`: ä½“åŠ›å€¼æ¨¡æ‹Ÿå™¨
    - `cost-model.service.ts`: æˆæœ¬æ¨¡å‹æœåŠ¡
    - `feasibility.service.ts`: å¯è¡Œæ€§æ£€æŸ¥æœåŠ¡
    - `ranking.service.ts`: æ’åæœåŠ¡
    - `replanner.service.ts`: é‡æ–°è§„åˆ’æœåŠ¡
    - `policy-compiler.service.ts`: ç­–ç•¥ç¼–è¯‘æœåŠ¡
    - `place-to-poi.service.ts`: Place è½¬ POI æœåŠ¡
    - `place-to-poi-helper.service.ts`: Place è½¬ POI è¾…åŠ©æœåŠ¡
  - `interfaces/`: æ¥å£å®šä¹‰ï¼ˆè§„åˆ’ç­–ç•¥ã€POIã€è°ƒåº¦å™¨ç­‰ï¼‰
  - `dto/`: æ•°æ®ä¼ è¾“å¯¹è±¡
  - `utils/`: å·¥å…·å‡½æ•°ï¼ˆæ—¶é—´å·¥å…·ç­‰ï¼‰

**æ ¸å¿ƒåŠŸèƒ½**:
- What-If è¯„ä¼°æŠ¥å‘Šï¼ˆç”Ÿæˆå€™é€‰æ–¹æ¡ˆå¹¶è¯„ä¼°ï¼‰
- ç¨³å¥åº¦è¯„ä¼°ï¼ˆæ—¶é—´çª—å£é”™è¿‡æ¦‚ç‡ã€å®Œæˆç‡ç­‰ï¼‰
- åº”ç”¨å€™é€‰æ–¹æ¡ˆ
- ä¸€é”®å¤è¯„

---

#### 2.10 `/src/voice/` - è¯­éŸ³è§£ææ¨¡å—
- **ä½œç”¨**: è§£æè¯­éŸ³è½¬æ–‡å­—çš„ transcriptï¼Œç”Ÿæˆç»“æ„åŒ–åŠ¨ä½œå»ºè®®
- **æ–‡ä»¶**:
  - `voice.controller.ts`: è¯­éŸ³è§£æ API æ§åˆ¶å™¨
  - `voice.service.ts`: è¯­éŸ³è§£æä¸šåŠ¡é€»è¾‘
  - `services/llm-voice-parser.service.ts`: LLM è¯­éŸ³è§£ææœåŠ¡
  - `dto/`: æ•°æ®ä¼ è¾“å¯¹è±¡

**æ ¸å¿ƒåŠŸèƒ½**:
- å°†è¯­éŸ³æ–‡æœ¬è§£æä¸ºåŠ¨ä½œå»ºè®®ï¼ˆQUERY_NEXT_STOP, MOVE_POI_TO_MORNING ç­‰ï¼‰
- å¦‚æœä¿¡æ¯ä¸è¶³ï¼Œè¿”å› clarificationï¼ˆéœ€è¦ç”¨æˆ·é€‰æ‹©ï¼‰

---

#### 2.11 `/src/vision/` - è§†è§‰è¯†åˆ«æ¨¡å—
- **ä½œç”¨**: æ‹ç…§è¯†åˆ« POI æ¨è
- **æ–‡ä»¶**:
  - `vision.controller.ts`: è§†è§‰è¯†åˆ« API æ§åˆ¶å™¨
  - `vision.service.ts`: è§†è§‰è¯†åˆ«ä¸šåŠ¡é€»è¾‘
  - `utils/keyword-extractor.util.ts`: å…³é”®è¯æå–å·¥å…·

**æ ¸å¿ƒåŠŸèƒ½**:
- OCR æå–æ–‡å­—ï¼ˆæ‹›ç‰Œ/èœå•ï¼‰
- POI Resolverï¼šç”¨æ–‡å­— + ç”¨æˆ·å®šä½æœç´¢ POI
- è¿”å›å€™é€‰ POI åˆ—è¡¨å’Œ"åŠ å…¥è¡Œç¨‹"å»ºè®®

---

#### 2.12 `/src/schedule-action/` - è¡Œç¨‹åŠ¨ä½œæ‰§è¡Œæ¨¡å—
- **ä½œç”¨**: æ‰§è¡ŒåŠ©æ‰‹å»ºè®®çš„åŠ¨ä½œï¼ˆç§»åŠ¨ POIã€æ·»åŠ  POI ç­‰ï¼‰
- **æ–‡ä»¶**:
  - `schedule-action.controller.ts`: è¡Œç¨‹åŠ¨ä½œ API æ§åˆ¶å™¨
  - `schedule-action.service.ts`: è¡Œç¨‹åŠ¨ä½œä¸šåŠ¡é€»è¾‘
  - `dto/`: æ•°æ®ä¼ è¾“å¯¹è±¡ï¼ˆåº”ç”¨åŠ¨ä½œè¯·æ±‚ç­‰ï¼‰

**æ ¸å¿ƒåŠŸèƒ½**:
- æ‰§è¡ŒåŠ¨ä½œï¼ˆQUERY_NEXT_STOP, MOVE_POI_TO_MORNING, ADD_POI_TO_SCHEDULEï¼‰
- è¿”å›ä¿®æ”¹åçš„è¡Œç¨‹è®¡åˆ’

---

### 3. åŸºç¡€è®¾æ–½æ¨¡å—

#### 3.1 `/src/prisma/` - Prisma ORM æ¨¡å—
- **ä½œç”¨**: æ•°æ®åº“è®¿é—®å±‚
- **æ–‡ä»¶**:
  - `prisma.module.ts`: Prisma æ¨¡å—å®šä¹‰
  - `prisma.service.ts`: Prisma æœåŠ¡ï¼ˆæ•°æ®åº“å®¢æˆ·ç«¯ï¼‰

---

#### 3.2 `/src/redis/` - Redis ç¼“å­˜æ¨¡å—
- **ä½œç”¨**: Redis ç¼“å­˜æœåŠ¡
- **æ–‡ä»¶**:
  - `redis.module.ts`: Redis æ¨¡å—å®šä¹‰
  - `redis.service.ts`: Redis æœåŠ¡

---

#### 3.3 `/src/providers/` - å¤–éƒ¨æœåŠ¡æä¾›è€…
- **ä½œç”¨**: å°è£…å¤–éƒ¨ API è°ƒç”¨ï¼ˆGoogle, Mapbox, é«˜å¾·ç­‰ï¼‰
- **æ–‡ä»¶**: å„ç§å¤–éƒ¨æœåŠ¡çš„å°è£…

---

#### 3.4 `/src/common/` - å…¬å…±æ¨¡å—
- **ä½œç”¨**: å…±äº«çš„å·¥å…·å‡½æ•°å’Œ DTO
- **æ–‡ä»¶**:
  - `dto/`: æ ‡å‡†å“åº” DTO
  - `utils/`: å·¥å…·å‡½æ•°
    - `currency-math.util.ts`: è´§å¸è®¡ç®—
    - `hotel-cost-calculator.util.ts`: é…’åº—æˆæœ¬è®¡ç®—
    - `opening-hours.util.ts`: è¥ä¸šæ—¶é—´å¤„ç†
    - `time-value-calculator.util.ts`: æ—¶é—´ä»·å€¼è®¡ç®—
    - `suggestion-id.util.ts`: å»ºè®® ID ç”Ÿæˆ

---

#### 3.5 `/src/tasks/` - å®šæ—¶ä»»åŠ¡æ¨¡å—
- **ä½œç”¨**: å®šæ—¶ä»»åŠ¡ç®¡ç†
- **æ–‡ä»¶**:
  - `tasks.module.ts`: å®šæ—¶ä»»åŠ¡æ¨¡å—å®šä¹‰
  - `tasks.service.ts`: å®šæ—¶ä»»åŠ¡æœåŠ¡

---

#### 3.6 `/src/assist/` - åŠ©æ‰‹æ¨¡å—
- **ä½œç”¨**: åŠ©æ‰‹ç›¸å…³åŠŸèƒ½
- **æ–‡ä»¶**:
  - `dto/action.dto.ts`: åŠ¨ä½œæ•°æ®ä¼ è¾“å¯¹è±¡

---

### 4. `/prisma/` - æ•°æ®åº“é…ç½®

#### 4.1 `/prisma/schema.prisma`
- **ä½œç”¨**: Prisma æ•°æ®åº“æ¨¡å¼å®šä¹‰
- **å†…å®¹**: å®šä¹‰æ‰€æœ‰æ•°æ®æ¨¡å‹ï¼ˆPlace, Trip, City, CountryProfile ç­‰ï¼‰

#### 4.2 `/prisma/migrations/`
- **ä½œç”¨**: æ•°æ®åº“è¿ç§»æ–‡ä»¶
- **æ–‡ä»¶**:
  - `add_city_fields.sql`: æ·»åŠ åŸå¸‚å­—æ®µçš„è¿ç§»
  - `create-indexes.sql`: åˆ›å»ºç´¢å¼•çš„è¿ç§»

---

### 5. `/scripts/` - æ•°æ®å¯¼å…¥å’Œå¤„ç†è„šæœ¬

#### 5.1 æ•°æ®å¯¼å…¥è„šæœ¬
- `import-cities-to-db.ts`: å¯¼å…¥åŸå¸‚æ•°æ®
- `import-cities-from-csv.ts`: ä» CSV å¯¼å…¥åŸå¸‚
- `import-airports.ts`: å¯¼å…¥æœºåœºæ•°æ®
- `import-airports-from-google.ts`: ä» Google å¯¼å…¥æœºåœº
- `import-nature-poi-from-geojson.ts`: ä» GeoJSON å¯¼å…¥è‡ªç„¶ POI
- `import-alltrails-to-db.ts`: å¯¼å…¥ AllTrails æ•°æ®

#### 5.2 æ•°æ®çˆ¬å–è„šæœ¬
- `scrape-alltrails.ts`: çˆ¬å– AllTrails æ•°æ®
- `scrape-alltrails-puppeteer.ts`: ä½¿ç”¨ Puppeteer çˆ¬å– AllTrails
- `scrape-alltrails-batch.ts`: æ‰¹é‡çˆ¬å– AllTrails
- `scrape-tibet-trails.ts`: çˆ¬å–è¥¿è—è·¯çº¿æ•°æ®
- `scrape-mafengwo-attractions.ts`: çˆ¬å–é©¬èœ‚çªæ™¯ç‚¹æ•°æ®
- `scrape-fliggy-attractions.ts`: çˆ¬å–é£çŒªæ™¯ç‚¹æ•°æ®

#### 5.3 æ•°æ®æ›´æ–°è„šæœ¬
- `enrich-attractions-from-amap.ts`: ä»é«˜å¾·åœ°å›¾ä¸°å¯Œæ™¯ç‚¹ä¿¡æ¯
- `update-alltrails-elevation.ts`: æ›´æ–° AllTrails é«˜ç¨‹æ•°æ®
- `update-potala-palace.ts`: æ›´æ–°å¸ƒè¾¾æ‹‰å®«æ•°æ®
- `manual-update-attractions.ts`: æ‰‹åŠ¨æ›´æ–°æ™¯ç‚¹æ•°æ®
- `generate-physical-metadata.ts`: ç”Ÿæˆç‰©ç†å…ƒæ•°æ®

#### 5.4 æ•°æ®è½¬æ¢è„šæœ¬
- `convert-city-data-to-import-format.ts`: è½¬æ¢åŸå¸‚æ•°æ®æ ¼å¼
- `merge-and-cleanup-adcode.ts`: åˆå¹¶å’Œæ¸…ç†è¡Œæ”¿åŒºåˆ’ä»£ç 
- `merge-and-cleanup-adcode.py`: Python ç‰ˆæœ¬çš„åˆå¹¶è„šæœ¬
- `merge-and-cleanup-adcode.sql`: SQL ç‰ˆæœ¬çš„åˆå¹¶è„šæœ¬
- `merge-and-cleanup-adcode-safe.sh`: å®‰å…¨çš„åˆå¹¶è„šæœ¬

#### 5.5 æµ‹è¯•è„šæœ¬
- `test-itinerary-optimization.ts`: æµ‹è¯•è·¯çº¿ä¼˜åŒ– API
- `test-optimize-request.json`: ä¼˜åŒ–è¯·æ±‚æµ‹è¯•æ•°æ®

#### 5.6 å·¥å…·è„šæœ¬
- `start-redis.sh`: å¯åŠ¨ Redis æœåŠ¡
- `run-city-migration.sh`: è¿è¡ŒåŸå¸‚è¿ç§»

#### 5.7 Python è„šæœ¬ç›®å½•
- `import-cities-python/`: Python ç‰ˆæœ¬çš„åŸå¸‚å¯¼å…¥è„šæœ¬
  - `import_cities.py`: ä¸»å¯¼å…¥è„šæœ¬
  - `import_cities_simple.py`: ç®€åŒ–ç‰ˆæœ¬
  - `config.py`: é…ç½®æ–‡ä»¶
  - `requirements.txt`: Python ä¾èµ–

---

### 6. `/tools/` - æµ‹è¯•å’Œå·¥å…·è„šæœ¬

- `end2end_difficulty_with_geojson.py`: è·¯çº¿éš¾åº¦ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆPythonï¼‰
- `test-difficulty-api.sh`: è·¯çº¿éš¾åº¦ API æµ‹è¯•è„šæœ¬
- `test-difficulty-integration.md`: è·¯çº¿éš¾åº¦é›†æˆæµ‹è¯•æ–‡æ¡£
- `test-difficulty-mock.py`: è·¯çº¿éš¾åº¦æ¨¡æ‹Ÿæµ‹è¯•
- `test-difficulty-simple.py`: è·¯çº¿éš¾åº¦ç®€å•æµ‹è¯•
- `test-with-env.py`: ç¯å¢ƒæµ‹è¯•è„šæœ¬

---

### 7. `/models/` - Python æ¨¡å‹

- `trail_difficulty.py`: è·¯çº¿éš¾åº¦è¯„ä¼°æ¨¡å‹ï¼ˆPythonï¼‰

---

### 8. `/data/` - æ•°æ®æ–‡ä»¶

- `examples/`: ç¤ºä¾‹æ•°æ®æ–‡ä»¶
  - `iceland-volcano-example.geojson`: å†°å²›ç«å±±ç¤ºä¾‹ GeoJSON

---

### 9. `/docs/` - æ–‡æ¡£ç›®å½•

- `API-æ¥å£æ–‡æ¡£-å‰ç«¯ä½¿ç”¨æŒ‡å—.md`: API æ¥å£æ–‡æ¡£ï¼ˆæœ¬æ–‡æ¡£ï¼‰
- å…¶ä»–æ–‡æ¡£æ–‡ä»¶

---

### 10. `/public/` - é™æ€èµ„æº

- Next.js é™æ€èµ„æºç›®å½•ï¼ˆå›¾ç‰‡ã€å›¾æ ‡ç­‰ï¼‰

---

## ğŸ“ é…ç½®æ–‡ä»¶è¯´æ˜

### `package.json`
- **ä½œç”¨**: Node.js é¡¹ç›®é…ç½®æ–‡ä»¶
- **å†…å®¹**:
  - é¡¹ç›®ä¾èµ–ï¼ˆNestJS, Prisma, Next.js ç­‰ï¼‰
  - npm è„šæœ¬ï¼ˆå¼€å‘ã€æ„å»ºã€æ•°æ®å¯¼å…¥ç­‰ï¼‰

### `tsconfig.json`
- **ä½œç”¨**: TypeScript é…ç½®æ–‡ä»¶ï¼ˆNext.js å‰ç«¯ï¼‰

### `tsconfig.backend.json`
- **ä½œç”¨**: TypeScript é…ç½®æ–‡ä»¶ï¼ˆNestJS åç«¯ï¼‰

### `nest-cli.json`
- **ä½œç”¨**: NestJS CLI é…ç½®æ–‡ä»¶

### `next.config.mjs`
- **ä½œç”¨**: Next.js é…ç½®æ–‡ä»¶

### `prisma.config.ts`
- **ä½œç”¨**: Prisma é…ç½®æ–‡ä»¶

### `.env.example.mapbox`
- **ä½œç”¨**: Mapbox API é…ç½®ç¤ºä¾‹

### `.gitignore`
- **ä½œç”¨**: Git å¿½ç•¥æ–‡ä»¶é…ç½®

---

## ğŸ”§ æŠ€æœ¯æ ˆ

### åç«¯
- **æ¡†æ¶**: NestJS 11
- **æ•°æ®åº“**: PostgreSQL + PostGIS
- **ORM**: Prisma 6
- **ç¼“å­˜**: Redis
- **API æ–‡æ¡£**: Swagger/OpenAPI

### å‰ç«¯
- **æ¡†æ¶**: Next.js 14
- **è¯­è¨€**: TypeScript 5
- **UI**: React 18

### å¤–éƒ¨æœåŠ¡
- Google Maps API
- Mapbox API
- é«˜å¾·åœ°å›¾ API
- Overpass API (OpenStreetMap)

### å·¥å…·
- Puppeteer (ç½‘é¡µçˆ¬å–)
- Playwright (æµè§ˆå™¨è‡ªåŠ¨åŒ–)
- Python (éƒ¨åˆ†æ•°æ®å¤„ç†è„šæœ¬)

---

## ğŸ“Š æ•°æ®æ¨¡å‹ï¼ˆPrisma Schemaï¼‰

ä¸»è¦æ•°æ®æ¨¡å‹ï¼š
- `Place`: åœ°ç‚¹ï¼ˆæ™¯ç‚¹ã€é¤å…ã€é…’åº—ç­‰ï¼‰
- `Trip`: è¡Œç¨‹
- `TripDay`: è¡Œç¨‹æ—¥æœŸ
- `ItineraryItem`: è¡Œç¨‹é¡¹
- `City`: åŸå¸‚
- `CountryProfile`: å›½å®¶æ¡£æ¡ˆ
- `FlightPriceReference`: æœºç¥¨ä»·æ ¼å‚è€ƒ
- `FlightPriceDetail`: æœºç¥¨ä»·æ ¼è¯¦æƒ…
- `HotelPriceDetail`: é…’åº—ä»·æ ¼è¯¦æƒ…
- `RawAttractionData`: åŸå§‹æ™¯ç‚¹æ•°æ®
- `RawTrainStationData`: åŸå§‹ç«è½¦ç«™æ•°æ®
- `RawHotelData_Slim`: åŸå§‹é…’åº—æ•°æ®

---

## ğŸš€ å¼€å‘æµç¨‹

### å¯åŠ¨åç«¯æœåŠ¡
```bash
npm run backend:dev
```

### å¯åŠ¨å‰ç«¯æœåŠ¡
```bash
npm run dev
```

### æ•°æ®åº“è¿ç§»
```bash
npm run prisma:migrate
```

### ç”Ÿæˆ Prisma Client
```bash
npm run prisma:generate
```

### æŸ¥çœ‹ API æ–‡æ¡£
è®¿é—® `http://localhost:3000/api` æŸ¥çœ‹ Swagger æ–‡æ¡£

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- API æ¥å£æ–‡æ¡£: `/docs/API-æ¥å£æ–‡æ¡£-å‰ç«¯ä½¿ç”¨æŒ‡å—.md`
- é¡¹ç›® README: `/README.md`
