# 航班价格详细字段扩展说明

## 概述

为了支持更精细的价格分析和预测，我们在 `FlightPriceDetail` 表中添加了以下新字段：

## 新增字段

### 1. distanceKm (里程)
- **类型**: `Float?`
- **说明**: 从原始数据中聚合的航线里程平均值（公里）
- **用途**: 
  - 衡量航线距离，是基础价格的决定因素之一
  - 可用于验证距离与价格的关系
  - 支持距离相关的价格分析

### 2. monthFactor (月度因子)
- **类型**: `Float?`
- **说明**: 该月基准价与全年平均价格的比值
- **计算公式**: `monthFactor = monthlyBasePrice / yearlyAveragePrice`
- **用途**:
  - 区分淡季和旺季（例如，春节前后的月份因子会很高）
  - 识别价格波动模式
  - 支持季节性价格预测

### 3. airlineCount (航司数量)
- **类型**: `Int?` (默认值: 0)
- **说明**: 该航线在给定月份有多少家唯一的航空公司
- **用途**:
  - 衡量市场垄断或竞争程度
  - 竞争激烈的航线通常价格更低
  - 支持市场竞争分析

### 4. isWeekend (是否周末)
- **类型**: `Boolean?` (默认值: false)
- **说明**: 基于 `dayOfWeek` 的布尔值（5=周六, 6=周日）
- **用途**:
  - 简化分析，直接区分工作日和周末价格差异
  - 支持周末价格策略分析
  - 快速筛选周末航班

### 5. departureTime (起飞时间)
- **类型**: `String?`
- **格式**: TIME 或 VARCHAR，如 "21:10:00"
- **说明**: 该航线在该月份最常见的起飞时间
- **用途**:
  - 分析不同时段的航班价格差异
  - 识别红眼航班（价格可能较低）
  - 识别商务高峰时段（价格可能较高）

### 6. arrivalTime (降落时间)
- **类型**: `String?`
- **格式**: TIME 或 VARCHAR，如 "01:25:00"
- **说明**: 该航线在该月份最常见的降落时间
- **用途**:
  - 分析到达时间对价格的影响
  - 识别方便时段（例如，下午 5 点到 7 点）的价格差异
  - 支持用户体验优化

### 7. timeOfDayFactor (时段因子)
- **类型**: `Float?`
- **说明**: 将一天划分为几个时段的价格因子
- **时段划分**:
  - **00-06**: 红眼航班（价格可能较低）
  - **06-12**: 上午高峰（商务出行，价格可能较高）
  - **12-18**: 下午时段
  - **18-24**: 晚上时段
- **计算公式**: `timeOfDayFactor = slotAveragePrice / monthlyBasePrice`
- **用途**:
  - 量化不同时段的价格差异
  - 支持时段相关的价格预测
  - 优化航班推荐策略

## 数据计算逻辑

### 导入脚本处理流程

1. **收集原始数据**:
   - 从 CSV/Excel 文件中读取所有字段
   - 包括：里程、航空公司、起飞时间、降落时间等

2. **按航线-月份-星期几分组**:
   - 收集每个组合的所有记录
   - 统计：价格、里程、航空公司、起飞/降落时间

3. **计算聚合值**:
   - `distanceKm`: 里程的平均值
   - `airlineCount`: 唯一航空公司数量
   - `departureTime/arrivalTime`: 最常见的起飞/降落时间
   - `isWeekend`: 基于 dayOfWeek (5 或 6)

4. **计算因子**:
   - `monthFactor`: 需要先计算全年平均价格
   - `timeOfDayFactor`: 根据起飞时间计算时段，然后计算该时段的价格因子

## API 响应示例

```json
{
  "estimatedPrice": 1753,
  "lowerBound": 1578,
  "upperBound": 1928,
  "monthlyBasePrice": 1740.79,
  "dayOfWeekFactor": 1.0069,
  "sampleCount": 14,
  "distanceKm": 1446.0,
  "monthFactor": 0.98,
  "airlineCount": 3,
  "isWeekend": false,
  "departureTime": "21:10:00",
  "arrivalTime": "01:25:00",
  "timeOfDayFactor": 1.05
}
```

## 使用建议

### 价格分析
- 使用 `monthFactor` 识别淡旺季
- 使用 `timeOfDayFactor` 分析时段价格差异
- 使用 `airlineCount` 评估市场竞争

### 用户体验优化
- 使用 `departureTime` 和 `arrivalTime` 推荐方便时段
- 使用 `isWeekend` 快速筛选周末航班
- 使用 `distanceKm` 验证价格合理性

### 预测模型
- 结合多个因子建立更精确的价格预测模型
- 考虑距离、时间、竞争程度等多维度因素

## 注意事项

1. **数据完整性**: 新字段可能为 `null`，如果原始数据中缺少相应字段
2. **重新导入**: 如果需要计算新字段，需要重新运行导入脚本
3. **性能影响**: 新字段会增加数据库存储空间，但不会显著影响查询性能

