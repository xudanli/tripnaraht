# 用户故事 - 按模块分类

本文档按模块组织用户故事，帮助理解整个项目的业务逻辑。

---

## 📋 目录

1. [行程管理 (Trips)](#1-行程管理-trips)
2. [地点管理 (Places)](#2-地点管理-places)
3. [行程项管理 (ItineraryItems)](#3-行程项管理-itineraryitems)
4. [路线优化 (ItineraryOptimization)](#4-路线优化-itineraryoptimization)
5. [交通规划 (Transport)](#5-交通规划-transport)
6. [规划策略 (PlanningPolicy)](#6-规划策略-planningpolicy)
7. [徒步路线 (Trails)](#7-徒步路线-trails)
8. [酒店推荐 (Hotels)](#8-酒店推荐-hotels)
9. [机票价格 (FlightPrices)](#9-机票价格-flightprices)
10. [国家档案 (Countries)](#10-国家档案-countries)
11. [语音解析 (Voice)](#11-语音解析-voice)
12. [视觉识别 (Vision)](#12-视觉识别-vision)
13. [行程动作执行 (ScheduleAction)](#13-行程动作执行-scheduleaction)
14. [LLM 智能服务 (LLM)](#14-llm-智能服务-llm)
15. [用户画像 (Users)](#15-用户画像-users)
16. [系统状态 (System)](#16-系统状态-system)

---

## 1. 行程管理 (Trips)

### 模块概述
管理用户的旅行行程，包括创建、查询、更新、删除行程，以及行程的状态管理、分享、复盘等功能。

### 核心用户故事

#### 故事 1.1：创建新行程
**作为** 一个旅行者  
**我想要** 创建一个新的旅行行程  
**以便** 开始规划我的旅行

**场景**：
- 用户填写目的地、日期、预算、旅行者信息
- 系统自动计算预算切分（每日预算、酒店档次推荐）
- 系统自动计算节奏策略（根据旅行者体力、地形限制）
- 创建成功后跳转到行程详情页

**验收标准**：
- ✅ 行程创建成功，返回行程ID
- ✅ 预算自动切分（扣除大交通后计算每日预算）
- ✅ 节奏策略自动计算（体力限制、地形限制）
- ✅ 酒店档次推荐（根据预算和行程密度）

---

#### 故事 1.2：自然语言创建行程
**作为** 一个旅行者  
**我想要** 用自然语言描述我的旅行需求  
**以便** 快速创建行程，无需填写复杂表单

**场景**：
- 用户说："帮我规划带娃去东京5天的行程，预算2万"
- 系统使用LLM解析需求，提取关键信息
- 如果信息不足，系统询问澄清问题
- 如果信息充足，自动创建行程

**验收标准**：
- ✅ LLM正确解析自然语言
- ✅ 提取目的地、日期、预算、旅行者信息
- ✅ 信息不足时返回澄清问题
- ✅ 信息充足时自动创建行程

---

#### 故事 1.3：查看行程详情
**作为** 一个旅行者  
**我想要** 查看我的行程详情  
**以便** 了解行程安排和活动列表

**场景**：
- 用户点击行程卡片进入详情页
- 显示时间轴视图，展示所有日期和活动
- 显示行程统计信息（总天数、总活动数、行程状态）
- 显示每个活动关联的地点详情

**验收标准**：
- ✅ 显示完整的行程信息（Trip + TripDay + ItineraryItem）
- ✅ 时间轴视图清晰展示日期和活动
- ✅ 统计信息准确
- ✅ 地点详情完整（名称、地址、坐标、营业时间等）

---

#### 故事 1.4：获取行程当前状态
**作为** 一个旅行者  
**我想要** 知道当前进行到哪一项活动  
**以便** 了解下一站是哪里

**场景**：
- 行程进行中，用户问"下一站是哪里？"
- 系统根据当前时间判断当前活动
- 返回当前日期ID、当前活动ID、下一站信息
- 显示下一站的预计到达时间

**验收标准**：
- ✅ 正确判断当前日期和活动
- ✅ 返回下一站信息（地点名称、开始时间、预计到达时间）
- ✅ 支持时区转换
- ✅ 自动判断行程状态（规划中/进行中/已完成）

---

#### 故事 1.5：生成行程复盘报告
**作为** 一个旅行者  
**我想要** 在行程结束后生成复盘报告  
**以便** 回顾旅行经历和统计数据

**场景**：
- 行程结束后，用户点击"生成复盘报告"
- 系统生成包含景点打卡顺序、徒步总里程、海拔变化等数据的报告
- 支持导出为可分享的格式
- 可以生成3D轨迹视频数据

**验收标准**：
- ✅ 报告包含完整的行程信息
- ✅ 统计信息准确（总里程、总爬升、总下降等）
- ✅ 支持导出功能
- ✅ 支持生成3D轨迹视频数据

---

#### 故事 1.6：分享和导入行程
**作为** 一个旅行者  
**我想要** 分享我的行程给其他用户  
**以便** 让他们可以参考或复用我的行程规划

**场景**：
- 用户生成分享链接
- 其他用户通过分享链接查看行程
- 其他用户可以选择导入行程，创建自己的副本
- 导入时包括所有Trail数据、行程项、GPX数据等

**验收标准**：
- ✅ 生成唯一的分享令牌
- ✅ 通过令牌可以查看完整行程数据
- ✅ 导入功能完整复制所有数据
- ✅ 支持设置分享有效期

---

## 2. 地点管理 (Places)

### 模块概述
管理地点数据，包括景点、餐厅、酒店、购物等，提供地点查询、推荐、搜索等功能。支持语义搜索（向量搜索），让用户可以用自然语言描述氛围和感觉，找到相关但不含关键词的地点。

### 核心用户故事

#### 故事 2.1：搜索地点
**作为** 一个旅行者  
**我想要** 搜索目的地附近的景点、餐厅等  
**以便** 找到我想去的地方

**场景**：
- 用户输入关键词"东京塔"
- 系统返回匹配的地点列表
- 支持按类别筛选（景点、餐厅、酒店、购物）
- 支持按距离排序

**验收标准**：
- ✅ 关键词搜索准确
- ✅ 支持中文和英文搜索
- ✅ 支持按类别筛选
- ✅ 支持按距离排序（如果提供了坐标）

---

#### 故事 2.2：查找附近地点
**作为** 一个旅行者  
**我想要** 查找当前位置附近的地点  
**以便** 发现周围有趣的地方

**场景**：
- 用户在地图上查看当前位置
- 系统显示附近的地点标记
- 支持按类型筛选（只显示餐厅、只显示景点等）
- 调整地图范围时动态加载新区域的地点

**验收标准**：
- ✅ 使用PostGIS空间查询，性能良好
- ✅ 支持按类型筛选
- ✅ 支持调整搜索半径
- ✅ 返回距离信息

---

#### 故事 2.3：酒店推荐（综合隐形成本）
**作为** 一个旅行者  
**我想要** 系统推荐合适的酒店  
**以便** 选择性价比最高的住宿

**场景**：
- 用户创建行程后，系统自动推荐酒店
- 根据已选景点，推荐地理位置最优的酒店
- 显示总成本（房价 + 交通费 + 时间成本）
- 根据行程密度自动选择策略（特种兵/大多数人/躺平）

**验收标准**：
- ✅ 推荐策略正确（CENTROID/HUB/RESORT）
- ✅ 显示总成本（包含隐形成本）
- ✅ 推荐理由清晰
- ✅ 支持按预算筛选

---

#### 故事 2.4：计算路线难度
**作为** 一个旅行者  
**我想要** 知道从A点到B点的路线难度  
**以便** 判断是否适合我的体力

**场景**：
- 用户选择起点和终点
- 系统计算路线难度（距离、爬升、坡度）
- 返回难度等级（EASY/MODERATE/HARD/EXTREME）
- 可选返回GeoJSON格式的路线数据

**验收标准**：
- ✅ 难度计算准确
- ✅ 支持多种交通方式（步行、驾车等）
- ✅ 考虑地形因素（海拔、坡度）
- ✅ 可选返回路线GeoJSON

---

#### 故事 2.5：查找自然POI
**作为** 一个旅行者  
**我想要** 查找附近的自然景点  
**以便** 规划自然风光类行程

**场景**：
- 用户在自然风光类行程中
- 系统推荐附近的自然POI（火山、冰川、瀑布、温泉等）
- 支持按子类别筛选
- 显示距离和评分

**验收标准**：
- ✅ 自然POI数据完整
- ✅ 支持按子类别筛选
- ✅ 距离计算准确
- ✅ 评分信息准确

---

#### 故事 2.6：语义地点搜索
**作为** 一个用户  
**我想要** 用自然语言描述氛围（如"适合冥想的安静庭院"）  
**以便** 找到那些名字里没有关键词但意境符合的地点

**场景**：
- 用户输入自然语言查询，如"像京都那样的地方"、"适合冥想的安静庭院"
- 系统使用向量搜索理解语义，返回相关地点
- 即使在东京，也能返回"根津美术馆"或"六义园"（虽然名字里没有"京都"）
- 搜索结果高亮显示"为什么推荐"（例如："根据评论提到的'静谧'和'日式庭院'推荐"）
- 支持混合搜索：向量搜索（语义）+ 关键词搜索（精确匹配）

**验收标准**：
- ✅ **AC1**：输入"像京都那样的地方"，即使在东京，也能返回"根津美术馆"或"六义园"
- ✅ **AC2**：搜索结果需高亮显示"为什么推荐"（例如："根据评论提到的'静谧'和'日式庭院'推荐"）
- ✅ 向量搜索准确度：语义相似度 > 0.7 的结果应相关
- ✅ 混合搜索效果：最终得分 = 向量得分 × 0.7 + 关键词得分 × 0.3
- ✅ 支持中英文自然语言查询
- ✅ 响应时间 < 2秒（含 embedding 生成）

---

## 3. 行程项管理 (ItineraryItems)

### 模块概述
管理行程中的具体活动项，包括景点游览、用餐、休息、交通等。

### 核心用户故事

#### 故事 3.1：添加活动到行程
**作为** 一个旅行者  
**我想要** 添加活动到我的行程  
**以便** 安排我的旅行日程

**场景**：
- 用户选择一个地点，点击"加入行程"
- 系统自动校验营业时间
- 系统检查时间冲突
- 添加成功后显示在时间轴上

**验收标准**：
- ✅ 自动校验营业时间
- ✅ 检查时间冲突
- ✅ 支持添加备注
- ✅ 时间轴正确显示

---

#### 故事 3.2：修改活动时间
**作为** 一个旅行者  
**我想要** 修改活动的时间  
**以便** 调整我的行程安排

**场景**：
- 用户拖拽时间轴上的活动，调整时间
- 系统重新校验营业时间
- 系统检查时间冲突
- 更新成功后刷新时间轴

**验收标准**：
- ✅ 时间修改成功
- ✅ 重新校验营业时间
- ✅ 检查时间冲突
- ✅ 时间轴正确更新

---

#### 故事 3.3：添加用餐时间
**作为** 一个旅行者  
**我想要** 在行程中添加用餐时间  
**以便** 预留用餐时间

**场景**：
- 用户选择用餐类型（早餐、午餐、晚餐）
- 系统自动推荐用餐时间窗口
- 支持固定时间（MEAL_ANCHOR）或浮动时间（MEAL_FLOATING）
- 添加成功后显示在时间轴上

**验收标准**：
- ✅ 用餐时间正确添加
- ✅ 支持固定和浮动时间
- ✅ 时间窗口合理
- ✅ 时间轴正确显示

---

## 4. 路线优化 (ItineraryOptimization)

### 模块概述
使用 VRPTW（带时间窗的车辆路径问题）算法优化路线，支持：
- **单日优化**：软硬节点优先级（必去/想去）、多时间窗支持、生活化约束、算法决策解释、规划偏好控制、鲁棒时间计算
- **多日切分**：区域聚类 + 均衡拆分，自动将 POI 分配到多天，满足区域化和均衡化指标
- **跨天修复**：当某天不可行时，自动触发跨天微调，移动低优先级点并重算

### 核心用户故事

#### 故事 4.1：优化路线顺序
**作为** 一个旅行者  
**我想要** 优化我选择的地点顺序  
**以便** 避免"折返跑"，提高旅行效率

**场景**：
- 用户选择多个地点后，点击"优化路线"
- 系统使用节奏感算法优化顺序
- 考虑距离、疲劳、兴趣匹配、聚类等因素
- 返回优化后的路线和时间安排

**验收标准**：
- ✅ 路线顺序优化合理（减少折返）
- ✅ 时间安排合理
- ✅ 显示快乐值和分数详情
- ✅ 在地图上显示优化后的路线

---

#### 故事 4.2：根据用户节奏优化
**作为** 一个旅行者  
**我想要** 根据我的节奏偏好优化路线  
**以便** 获得最适合我的行程安排

**场景**：
- 用户选择节奏偏好（快/标准/慢）
- 系统根据节奏调整时间安排
- 带老人/小孩时，自动调整节奏和休息时间
- 返回优化后的路线

**验收标准**：
- ✅ 节奏偏好正确应用
- ✅ 时间安排符合节奏
- ✅ 带老人/小孩时自动调整
- ✅ 休息时间合理

---

#### 故事 4.3：智能取舍与多时间窗
**作为** 一个旅行者  
**我想要** 系统支持"必去/想去"优先级和"多段营业时间"  
**以便** 在时间紧张时自动放弃低优先级景点，并精准避开闭馆/午休时间

**场景**：
- 用户标记地点为"必去"或"想去"
- 系统支持同一地点配置多个时间窗（如午市 11:30-14:00、晚市 17:30-22:00）
- 时间不足时，系统自动舍弃"想去"的低优先级地点
- 系统确保"必去"地点必须包含，否则返回冲突错误
- 多时间窗地点只选择其中一个时段访问

**验收标准**：
- ✅ Soft 节点在时间窗冲突时可被自动移除，不报错
- ✅ Hard 节点冲突时才返回行程冲突错误，并给出调整建议
- ✅ 双时段营业地点，行程只允许落在其中一个有效时段
- ✅ 结果包含 dropped_items 列表，每个丢弃项包含原因代码、简述、关键冲突信息

---

#### 故事 4.4：生活化约束
**作为** 一个注重体验的旅行者  
**我想要** 行程符合正常作息与营业规律  
**以便** 跟着走不会疲惫或尴尬

**场景**：
- 系统强制包含午餐时间块（60分钟，11:30-13:30）
- 系统确保到达和开始服务时间在营业时间内
- 系统计算并显示等待时间（早到等待）
- 系统避免在闭馆时间到达地点
- 系统默认第一站不早于 09:00（除非用户手动设置更早）

**验收标准**：
- ✅ 每日必须包含 60min 午餐时间块，落在 11:30–13:30
- ✅ 到达与开始服务必须在营业时间内
- ✅ 等待时间可见（>15分钟显式显示）
- ✅ 晚于关门时间到达的方案不可用
- ✅ 早起保护：默认第一站不早于 09:00

---

#### 故事 4.5：算法决策解释
**作为** 一个旅行者  
**我想要** 知道为什么行程这样安排（特别是为什么丢了某些点）  
**以便** 理解取舍，而不是怀疑系统漏点或出 bug

**场景**：
- 系统丢弃某些地点时，提供自然语言解释
- 解释包含具体冲突点（时间、地点、日界）
- 解释包含调整建议（提前出发、减少停留、改天等）
- 前端提供"为什么这样排？"和"为什么没安排？"入口

**验收标准**：
- ✅ 每个 Dropped Item 必须附带一条自然语言解释
- ✅ 解释必须包含至少一个"具体锚点"（关门时间/入场截止/日界/等待分钟）
- ✅ 前端必须提供可见入口查看解释详情
- ✅ 反直觉路径必须解释其必要性

---

#### 故事 4.6：规划偏好控制
**作为** 一个有特定旅行风格的用户  
**我想要** 调整行程松紧度和作息偏好  
**以便** 生成符合体力与节奏的计划（特种兵 vs 躺平党）

**场景**：
- 用户通过松紧度滑杆选择：宽松/标准/紧凑
- 用户设置最早出发时间和最晚结束时间
- 系统根据偏好调整 buffer、等待惩罚、密度惩罚等参数
- 调整后重新规划，行程点数/空档/等待/总缓冲至少一项出现可感知变化

**验收标准**：
- ✅ 调整松紧度后重新规划，至少一项指标出现可感知变化
- ✅ 设置"不早于 10:00 出发"后，第一站的 start_service 必须 ≥ 10:00
- ✅ 偏好设置必须体现在算法参数中，并影响输出 summary 指标
- ✅ 支持三种模式：relaxed（宽松）、normal（标准）、intense（紧凑）

---

#### 故事 4.7：多日行程自动拆解
**作为** 一个用户  
**我想要** 系统自动把我想去的 30 个点合理分配到 3 天里  
**以便** 每天都在一个区域活动，减少跨城折返，并且每天安排相对均衡

**场景**：
- 用户选择多个 POI（如 30 个）并设置行程天数（如 3 天）
- 系统执行"区域聚类 + 均衡拆分"，生成 Day1..DayN 的 POI 分组
- 每一天分组内部再执行日内路线优化（时间窗/午餐/必去想去/可丢弃）
- 若某天不可行，系统自动触发跨天微调（移动低优先级点）并重算
- 直到可行或给出明确冲突提示
- 用户可锁定某点在哪一天（锁定后重算仍保持）

**验收标准**：
- ✅ **区域化**：每日行程在地图上呈现明显区域聚集特征；同一天 POI 的空间分布明显更紧凑
  - 系统需提供"区域化指标"：`max(radius_day) < 5km` 或 `max(radius_day) < 0.5 * min(inter_center_distance)`
- ✅ **均衡化**：每天负载相对均衡（至少满足其一）：
  - 点数：`std(count)/mean(count) ≤ 0.25`
  - 或时长：`std(total_estimated_minutes)/mean(...) ≤ 0.20`
- ✅ **可执行**：每一天必须输出可执行时间表；仅当"必去约束导致任一日不可行"时才返回冲突提示
- ✅ **可解释**：若发生跨天调整，需在结果中说明"为什么把点 A 从 Day2 移到 Day3"（如 Day2 日界超标/时间窗冲突）
- ✅ **可控**：用户可锁定某点在哪一天（锁定后重算仍保持）

**UI/交互建议**：
- 地图按天着色（Day1/Day2/Day3 颜色区分）
- 每日列表顶部展示：点数、预计总耗时、区域名/中心区域（自动摘要）
- 支持拖拽 POI 跨天（触发重算该天路线）

**测试用例**：
- **TC-MD-01**：30 点 / 3 天游，点分布为 3 个明显区域 → 应拆成 3 个区域天，且均衡指标达标
- **TC-MD-02**：30 点高度集中在 1 个区域 → 仍需均衡分天（按时长/点数），并保持日内可执行
- **TC-MD-03**：某些点有严格时间窗（如演出/预约） → 系统将其分配到合适那天，否则提示需要调整天数/日界

---

## 5. 交通规划 (Transport)

### 模块概述
规划行程项之间的交通方式，智能推荐最优交通方案。使用鲁棒时间计算，确保包含缓冲、切换、跨区惩罚，降低迟到风险。

### 核心用户故事

#### 故事 5.1：规划交通路线
**作为** 一个旅行者  
**我想要** 知道从A点到B点的最佳交通方式  
**以便** 选择最合适的交通方案

**场景**：
- 用户查看行程项之间的交通
- 系统根据用户画像（行李、老人、天气）智能推荐
- 显示多个交通选项（步行、公交、打车、高铁等）
- 显示"痛苦指数"和推荐理由

**验收标准**：
- ✅ 交通选项完整
- ✅ 推荐理由清晰
- ✅ 考虑用户画像
- ✅ 显示"痛苦指数"

---

#### 故事 5.2：特殊建议
**作为** 一个旅行者  
**我想要** 获得特殊的交通建议  
**以便** 优化我的旅行体验

**场景**：
- 系统检测到用户有行李，建议使用宅急便
- 系统检测到天气不好，建议打车而非步行
- 系统检测到有老人，建议选择无障碍交通
- 显示特殊建议和理由

**验收标准**：
- ✅ 特殊建议准确
- ✅ 建议理由清晰
- ✅ 考虑多种因素（行李、天气、老人等）
- ✅ 建议可操作

---

#### 故事 5.3：真实的交通时间
**作为** 一个旅行者  
**我想要** 看到的是包含缓冲的"保守到达时间"  
**以便** 不因堵车/找路/排队而迟到

**场景**：
- 系统使用鲁棒时间计算（T_robust = T_api × buffer_factor + fixed_buffer）
- 前端展示允许使用区间表达："约 45–60 分钟"或"预计 10:00 到达（含缓冲）"
- 活动转场必须预留"最后 1 公里"缓冲（默认 15min）
- 涉及模态切换（地铁→打车等）需计入等车/换乘时间

**验收标准**：
- ✅ 底层必须使用鲁棒时间（含 buffer_factor + fixed_buffer）
- ✅ 前端展示允许使用区间表达
- ✅ 活动转场必须预留缓冲（默认 15min）
- ✅ 模态切换需计入等车/换乘时间

---

---

---

 7. 徒步路线 (Trails)

### 模块概述
管理徒步路线数据，提供路线推荐、沿途景点识别、路线拆分、配套服务推荐、实时追踪等功能。

### 核心用户故事

#### 故事 7.1：导入GPX轨迹创建路线
**作为** 一个徒步爱好者  
**我想要** 导入GPX轨迹文件创建徒步路线  
**以便** 记录和管理我的徒步路线

**场景**：
- 用户上传GPX文件
- 系统解析GPX数据，提取轨迹点、距离、爬升等信息
- 自动计算路线难度和疲劳分数
- 创建Trail记录，可选关联起点和终点Place

**验收标准**：
- ✅ GPX解析准确
- ✅ 距离、爬升、下降等数据正确
- ✅ 难度计算准确
- ✅ 支持关联起点和终点Place（可选）

---

#### 故事 7.2：根据景点推荐徒步路线
**作为** 一个旅行者  
**我想要** 根据我选择的景点推荐徒步路线  
**以便** 找到能够串联这些景点的徒步路径

**场景**：
- 用户选择多个景点（如山区观景台、古村落群）
- 系统查找能够串联这些景点的Trail
- 优先推荐小众步道而非公路
- 显示路线难度、耗时、距离等信息

**验收标准**：
- ✅ 推荐路线能够串联景点
- ✅ 优先推荐非公路步道
- ✅ 显示路线详细信息
- ✅ 支持按距离、难度筛选

---

#### 故事 7.3：识别路线沿途的景点
**作为** 一个徒步爱好者  
**我想要** 知道徒步路线沿途有哪些景点  
**以便** 规划包含景点的徒步行程

**场景**：
- 用户导入GPX轨迹后，系统自动识别沿途3公里内的景点
- 显示景点列表，包含距离、类别、评分等信息
- 推荐用户将沿途景点加入行程
- 支持调整搜索半径

**验收标准**：
- ✅ 沿途景点识别准确
- ✅ 距离计算正确
- ✅ 支持调整搜索半径
- ✅ 推荐理由清晰

---

#### 故事 7.4：拆分长路线为多段
**作为** 一个旅行者  
**我想要** 将长徒步路线拆分成多段  
**以便** 规划多日徒步行程

**场景**：
- 用户有一条长路线（如30公里）
- 系统根据用户体力自动拆分成多段
- 每段适合单日游玩（如15公里）
- 显示每段的起点、终点、距离、爬升等信息

**验收标准**：
- ✅ 路线拆分合理
- ✅ 每段长度适合单日
- ✅ 显示分段详细信息
- ✅ 支持手动调整分段长度

---

#### 故事 7.5：推荐徒步配套服务
**作为** 一个徒步爱好者  
**我想要** 获得徒步路线的配套服务推荐  
**以便** 做好充分准备

**场景**：
- 用户查看路线详情后，系统推荐配套服务
- 根据路线难度推荐装备租赁或采购
- 高海拔路线推荐高原反应保险
- 推荐沿途补给点和应急服务
- 显示医疗点和避难所位置

**验收标准**：
- ✅ 装备推荐准确
- ✅ 保险推荐合理
- ✅ 补给点位置准确
- ✅ 应急服务信息完整

---

#### 故事 7.6：检查路线适合性
**作为** 一个旅行者  
**我想要** 检查路线是否适合我的体力  
**以便** 避免选择超出能力的路线

**场景**：
- 用户查看路线详情
- 系统根据用户的体力配置（PacingConfig）检查路线适合性
- 显示疲劳消耗、预计耗时、警告信息（如有）
- 自动过滤不适合的路线

**验收标准**：
- ✅ 适合性评估准确
- ✅ 疲劳消耗计算正确
- ✅ 警告信息清晰
- ✅ 自动过滤功能正常

---

#### 故事 7.7：智能路线规划
**作为** 一个旅行者  
**我想要** 系统自动规划最优的景点+轨迹组合  
**以便** 获得最适合我的徒步行程

**场景**：
- 用户选择多个目标景点
- 系统自动评估每个Trail的适合性
- 根据体力限制自动拆分到多天
- 优先推荐匹配度高且适合用户体力的路线
- 返回推荐的Trail组合和行程安排

**验收标准**：
- ✅ 路线组合合理
- ✅ 适合性评估准确
- ✅ 自动拆分功能正常
- ✅ 推荐理由清晰

---

#### 故事 7.8：实时轨迹追踪
**作为** 一个徒步爱好者  
**我想要** 实时追踪我的位置  
**以便** 了解是否偏离计划路线

**场景**：
- 用户开始徒步，启动追踪功能
- 系统定期记录当前位置（如每10秒或每50米）
- 实时显示与计划轨迹的偏差
- 更新统计信息（总距离、爬升、速度等）

**验收标准**：
- ✅ 位置追踪准确
- ✅ 偏差计算正确
- ✅ 统计信息实时更新
- ✅ 支持离线追踪

---

#### 故事 7.9：结束追踪并生成报告
**作为** 一个徒步爱好者  
**我想要** 结束追踪并查看完整统计  
**以便** 回顾我的徒步经历

**场景**：
- 用户结束徒步，停止追踪
- 系统生成完整的统计信息
- 显示总距离、总爬升、平均速度、最大速度、持续时间等
- 显示所有轨迹点，可用于生成3D轨迹视频

**验收标准**：
- ✅ 统计信息完整
- ✅ 数据准确
- ✅ 支持导出轨迹数据
- ✅ 可用于生成3D视频

---

---

---
---

## 6. 规划策略 (PlanningPolicy)

### 模块概述
提供行程规划的稳健度评估、What-If分析和优化建议，帮助用户发现潜在风险并优化行程安排。使用鲁棒交通时间（T_robust）进行可行性检查，输出稳健度元数据（总缓冲时间、最紧张节点、风险等级）。

### 核心用户故事

#### 故事 6.1：评估行程稳健度
**作为** 一个旅行者  
**我想要** 评估我的行程计划的稳健度  
**以便** 发现潜在风险并提前准备

**场景**：
- 用户完成一天的行程规划后，系统自动计算稳健度
- 系统使用鲁棒交通时间（含缓冲/切换/跨区惩罚）评估行程
- 显示总缓冲时间、总等待时间、最紧张的 3 个节点剩余时间
- 显示风险等级（low/medium/high）
- 若按理想时间可赶上、但按鲁棒时间赶不上，系统判定不可行并重排/丢弃

**验收标准**：
- ✅ 所有行程规划与可行性检查必须使用 T_robust，严禁直接使用地图 API 原始时间
- ✅ 若按理想时间可赶上、但按鲁棒时间赶不上，系统必须判定不可行并执行：重排/丢弃 Soft/提示调整
- ✅ API 响应必须包含稳健度元数据：total_buffer_minutes + top3_min_slack_nodes（含 node_id 与 slack_min）
- ✅ 风险等级准确（low/medium/high）

---

#### 故事 6.2：生成优化建议
**作为** 一个旅行者  
**我想要** 获得行程优化建议  
**以便** 改善我的行程安排

**场景**：
- 系统评估行程后，自动生成优化建议
- 建议包括：提前出发、延后出发、删除活动等
- 每个建议包含原因和预期效果
- 用户可以选择要评估的建议

**验收标准**：
- ✅ 优化建议合理
- ✅ 建议原因清晰
- ✅ 支持选择要评估的建议
- ✅ 建议可操作

---

#### 故事 6.3：What-If评估（完整流程）
**作为** 一个旅行者  
**我想要** 评估不同的行程方案  
**以便** 选择最优的行程安排

**场景**：
- 用户选择要评估的优化建议
- 系统对候选方案运行MC评估
- 显示原计划和候选方案的对比
- 自动推荐最佳方案（winnerId）
- 显示风险警告（如有）

**验收标准**：
- ✅ 候选方案评估准确
- ✅ 对比清晰（原计划 vs 候选方案）
- ✅ 自动推荐最佳方案
- ✅ 风险警告准确

---

#### 故事 6.4：What-If评估（分步流程）
**作为** 一个旅行者  
**我想要** 分步查看What-If评估结果  
**以便** 更好地理解评估过程

**场景**：
- 第一步：快速显示base风险指标
- 第二步：生成候选方案列表（不包含评估结果）
- 第三步：用户选择要评估的候选方案
- 第四步：对选中的候选方案运行MC评估
- 最后：显示评估结果和推荐方案

**验收标准**：
- ✅ 分步流程清晰
- ✅ 每步结果独立
- ✅ 支持用户选择要评估的方案
- ✅ 最终结果完整

---

#### 故事 6.5：应用优化方案
**作为** 一个旅行者  
**我想要** 应用What-If评估推荐的方案  
**以便** 优化我的行程安排

**场景**：
- 用户查看What-If评估结果后，选择"应用该方案"
- 系统将候选方案的Schedule应用到行程中
- 更新行程计划，刷新时间轴视图
- 保存到数据库

**验收标准**：
- ✅ 方案应用成功
- ✅ 行程计划正确更新
- ✅ 时间轴视图刷新
- ✅ 数据保存到数据库

---

#### 故事 6.6：一键复评（确认推荐方案）
**作为** 一个旅行者  
**我想要** 用更高精度复评优化方案  
**以便** 最终确认优化效果

**场景**：
- 用户应用方案后，点击"一键复评"
- 系统使用更高samples（如600）重新评估
- 显示更稳定的评估结果
- 增加可信度

**验收标准**：
- ✅ 复评使用更高samples
- ✅ 评估结果更稳定
- ✅ 显示详细评估报告
- ✅ 用于最终确认

---

## 7. 徒步路线 (Trails)

### 模块概述
管理徒步路线数据，提供路线推荐、沿途景点识别、路线拆分、配套服务推荐、实时追踪等功能。

### 核心用户故事

#### 故事 7.1：导入GPX轨迹创建路线
**作为** 一个徒步爱好者  
**我想要** 导入GPX轨迹文件创建徒步路线  
**以便** 记录和管理我的徒步路线

**场景**：
- 用户上传GPX文件
- 系统解析GPX数据，提取轨迹点、距离、爬升等信息
- 自动计算路线难度和疲劳分数
- 创建Trail记录，可选关联起点和终点Place

**验收标准**：
- ✅ GPX解析准确
- ✅ 距离、爬升、下降等数据正确
- ✅ 难度计算准确
- ✅ 支持关联起点和终点Place（可选）

---

#### 故事 7.2：根据景点推荐徒步路线
**作为** 一个旅行者  
**我想要** 根据我选择的景点推荐徒步路线  
**以便** 找到能够串联这些景点的徒步路径

**场景**：
- 用户选择多个景点（如山区观景台、古村落群）
- 系统查找能够串联这些景点的Trail
- 优先推荐小众步道而非公路
- 显示路线难度、耗时、距离等信息

**验收标准**：
- ✅ 推荐路线能够串联景点
- ✅ 优先推荐非公路步道
- ✅ 显示路线详细信息
- ✅ 支持按距离、难度筛选

---

#### 故事 7.3：识别路线沿途的景点
**作为** 一个徒步爱好者  
**我想要** 知道徒步路线沿途有哪些景点  
**以便** 规划包含景点的徒步行程

**场景**：
- 用户导入GPX轨迹后，系统自动识别沿途3公里内的景点
- 显示景点列表，包含距离、类别、评分等信息
- 推荐用户将沿途景点加入行程
- 支持调整搜索半径

**验收标准**：
- ✅ 沿途景点识别准确
- ✅ 距离计算正确
- ✅ 支持调整搜索半径
- ✅ 推荐理由清晰

---

#### 故事 7.4：拆分长路线为多段
**作为** 一个旅行者  
**我想要** 将长徒步路线拆分成多段  
**以便** 规划多日徒步行程

**场景**：
- 用户有一条长路线（如30公里）
- 系统根据用户体力自动拆分成多段
- 每段适合单日游玩（如15公里）
- 显示每段的起点、终点、距离、爬升等信息

**验收标准**：
- ✅ 路线拆分合理
- ✅ 每段长度适合单日
- ✅ 显示分段详细信息
- ✅ 支持手动调整分段长度

---

#### 故事 7.5：推荐徒步配套服务
**作为** 一个徒步爱好者  
**我想要** 获得徒步路线的配套服务推荐  
**以便** 做好充分准备

**场景**：
- 用户查看路线详情后，系统推荐配套服务
- 根据路线难度推荐装备租赁或采购
- 高海拔路线推荐高原反应保险
- 推荐沿途补给点和应急服务
- 显示医疗点和避难所位置

**验收标准**：
- ✅ 装备推荐准确
- ✅ 保险推荐合理
- ✅ 补给点位置准确
- ✅ 应急服务信息完整

---

#### 故事 7.6：检查路线适合性
**作为** 一个旅行者  
**我想要** 检查路线是否适合我的体力  
**以便** 避免选择超出能力的路线

**场景**：
- 用户查看路线详情
- 系统根据用户的体力配置（PacingConfig）检查路线适合性
- 显示疲劳消耗、预计耗时、警告信息（如有）
- 自动过滤不适合的路线

**验收标准**：
- ✅ 适合性评估准确
- ✅ 疲劳消耗计算正确
- ✅ 警告信息清晰
- ✅ 自动过滤功能正常

---

#### 故事 7.7：智能路线规划
**作为** 一个旅行者  
**我想要** 系统自动规划最优的景点+轨迹组合  
**以便** 获得最适合我的徒步行程

**场景**：
- 用户选择多个目标景点
- 系统自动评估每个Trail的适合性
- 根据体力限制自动拆分到多天
- 优先推荐匹配度高且适合用户体力的路线
- 返回推荐的Trail组合和行程安排

**验收标准**：
- ✅ 路线组合合理
- ✅ 适合性评估准确
- ✅ 自动拆分功能正常
- ✅ 推荐理由清晰

---

#### 故事 7.8：实时轨迹追踪
**作为** 一个徒步爱好者  
**我想要** 实时追踪我的位置  
**以便** 了解是否偏离计划路线

**场景**：
- 用户开始徒步，启动追踪功能
- 系统定期记录当前位置（如每10秒或每50米）
- 实时显示与计划轨迹的偏差
- 更新统计信息（总距离、爬升、速度等）

**验收标准**：
- ✅ 位置追踪准确
- ✅ 偏差计算正确
- ✅ 统计信息实时更新
- ✅ 支持离线追踪

---

#### 故事 7.9：结束追踪并生成报告
**作为** 一个徒步爱好者  
**我想要** 结束追踪并查看完整统计  
**以便** 回顾我的徒步经历

**场景**：
- 用户结束徒步，停止追踪
- 系统生成完整的统计信息
- 显示总距离、总爬升、平均速度、最大速度、持续时间等
- 显示所有轨迹点，可用于生成3D轨迹视频

**验收标准**：
- ✅ 统计信息完整
- ✅ 数据准确
- ✅ 支持导出轨迹数据
- ✅ 可用于生成3D视频

---

## 8. 酒店推荐 (Hotels)

### 模块概述
提供酒店价格估算和推荐功能，帮助用户选择合适的住宿。支持价格趋势预测和买入信号，帮助用户做出购买决策。

### 核心用户故事

#### 故事 8.1：估算酒店价格
**作为** 一个旅行者  
**我想要** 估算目的地的酒店价格  
**以便** 规划住宿预算

**场景**：
- 用户选择目的地和酒店星级
- 系统根据年份和季度估算价格
- 显示价格区间（最低价-最高价）
- 可选显示推荐酒店列表

**验收标准**：
- ✅ 价格估算合理
- ✅ 支持不同星级
- ✅ 显示价格区间
- ✅ 可选显示推荐列表

---

#### 故事 8.2：查看城市所有星级价格选项
**作为** 一个旅行者  
**我想要** 查看目的地的所有星级价格对比  
**以便** 选择合适档次的酒店

**场景**：
- 用户选择目的地
- 系统显示1-5星的价格对比表
- 帮助用户选择合适档次的酒店
- 显示价格因子和样本数量，增加可信度

**验收标准**：
- ✅ 价格对比表完整
- ✅ 支持1-5星
- ✅ 显示价格因子
- ✅ 样本数量准确

---

#### 故事 8.3：酒店价格趋势预测
**作为** 一个预算敏感用户  
**我想要** 知道现在订酒店是贵了还是便宜了  
**以便** 决定是立即预订还是再等等

**场景**：
- 用户查看酒店价格时，系统显示价格趋势信号
- 显示简单的红/绿/黄信号（同 Story 9.3）
- 显示未来 30 天的价格预测趋势线
- 显示历史价格统计和建议
- 支持按城市和星级预测

**验收标准**：
- ✅ 界面显示价格趋势信号（红/绿/黄）
- ✅ 显示未来 30 天的价格预测趋势线
- ✅ 预测准确度：MAPE < 20%
- ✅ 支持不同城市和星级
- ✅ 提供自然语言建议

---

## 9. 机票价格 (FlightPrices)

### 模块概述
提供机票和签证价格估算功能，帮助用户规划大交通预算。支持价格趋势预测和买入信号，使用 Prophet 模型进行时间序列预测，识别季节性模式和节假日效应。

### 核心用户故事

#### 故事 9.1：估算机票+签证成本
**作为** 一个旅行者  
**我想要** 估算机票和签证费用  
**以便** 规划大交通预算

**场景**：
- 用户选择目的地和出发城市
- 系统估算机票价格（支持保守估算和平均估算）
- 系统估算签证费用
- 显示总成本（机票 + 签证）

**验收标准**：
- ✅ 价格估算合理
- ✅ 支持保守和平均估算
- ✅ 签证费用准确
- ✅ 总成本计算正确

---

#### 故事 9.2：估算国内航线价格
**作为** 一个旅行者  
**我想要** 估算国内航线的机票价格  
**以便** 选择出行日期

**场景**：
- 用户选择出发城市、目的地城市、月份、星期几
- 系统估算价格，考虑月份因子和周内因子
- 显示价格区间（最低价-最高价）
- 帮助用户选择出行日期

**验收标准**：
- ✅ 价格估算准确
- ✅ 考虑月份和周内因子
- ✅ 显示价格区间
- ✅ 帮助选择出行日期

---

#### 故事 9.3：价格趋势红绿灯
**作为** 一个预算敏感用户  
**我想要** 知道现在买机票是贵了还是便宜了  
**以便** 决定是立即下手还是再等等

**场景**：
- 用户查看机票价格时，系统显示价格趋势信号
- 显示简单的红/绿/黄信号：
  - 绿色（BUY）：当前价格低于历史均值 15%，建议买入
  - 红色（WAIT）：当前价格高于历史均值 15%，建议观望
  - 黄色（NEUTRAL）：价格处于正常范围
- 显示未来 30 天的价格预测趋势线
- 显示历史价格统计（均值、最低、最高）
- 提供自然语言建议（如"当前价格处于低位，建议立即购买"）

**验收标准**：
- ✅ **AC1**：界面显示简单的红/绿/黄信号，包含价格变化百分比和建议
- ✅ **AC2**：显示未来 30 天的价格预测趋势线（含置信区间）
- ✅ 预测准确度：MAPE < 20%（与历史同期均值法对比）
- ✅ 信号判断准确：基于历史均值和预测价格
- ✅ 支持机票和酒店价格预测

---

## 10. 国家档案 (Countries)

### 模块概述
提供国家档案信息，包括货币策略、支付方式、汇率等。

### 核心用户故事

#### 故事 10.1：查看国家货币策略
**作为** 一个旅行者  
**我想要** 了解目的地的货币信息  
**以便** 做好支付准备

**场景**：
- 用户选择目的地国家
- 系统显示货币代码、汇率、速算口诀
- 显示支付画像（现金为主/混合/数字化）
- 显示支付实用建议（小费、ATM、钱包App等）

**验收标准**：
- ✅ 货币信息准确
- ✅ 汇率实时更新
- ✅ 支付画像准确
- ✅ 实用建议清晰

---

## 11. 语音解析 (Voice)

### 模块概述
提供语音转文字和语音指令解析功能，支持语音交互。

### 核心用户故事

#### 故事 11.1：转写音频为文字
**作为** 一个旅行者  
**我想要** 将语音转换为文字  
**以便** 使用语音输入功能

**场景**：
- 用户录制语音指令
- 系统使用ASR（语音识别）转换为文字
- 支持多语言，自动识别语言
- 可选获取词级时间戳

**验收标准**：
- ✅ 转写准确
- ✅ 支持多语言
- ✅ 自动识别语言
- ✅ 可选词级时间戳

---

#### 故事 11.2：将文字转换为语音
**作为** 一个旅行者  
**我想要** 将文字转换为语音  
**以便** 在驾驶或走路时听取回复

**场景**：
- 系统生成文字回复
- 使用TTS（文字转语音）转换为语音
- 支持多语言和不同声音
- 返回音频文件或URL

**验收标准**：
- ✅ 语音质量良好
- ✅ 支持多语言
- ✅ 支持不同声音
- ✅ 返回格式正确

---

#### 故事 11.3：解析语音文本
**作为** 一个旅行者  
**我想要** 用语音控制我的行程  
**以便** 在驾驶或走路时操作

**场景**：
- 用户说"下一站是哪里？"，系统解析为查询指令
- 用户说"把东京塔移到上午"，系统解析为移动动作
- 用户说"添加浅草寺到行程"，系统解析为添加动作
- 信息不足时，显示选择界面让用户确认

**验收标准**：
- ✅ 意图识别准确
- ✅ 实体提取正确
- ✅ 信息不足时返回澄清问题
- ✅ 信息充足时直接执行动作

---

## 12. 视觉识别 (Vision)

### 模块概述
提供拍照识别POI功能，支持OCR和图像识别。

### 核心用户故事

#### 故事 12.1：查询Vision服务能力
**作为** 一个旅行者  
**我想要** 了解Vision服务的支持格式  
**以便** 正确上传图片

**场景**：
- 用户准备上传图片
- 系统返回支持的文件格式、最大文件大小等信息
- 显示是否需要压缩、是否支持HEIC格式等
- 帮助用户准备图片

**验收标准**：
- ✅ 能力信息准确
- ✅ 格式支持清晰
- ✅ 大小限制明确
- ✅ 压缩建议合理

---

#### 故事 12.2：拍照识别POI推荐
**作为** 一个旅行者  
**我想要** 拍照识别感兴趣的招牌或菜单  
**以便** 快速找到相关地点

**场景**：
- 用户看到感兴趣的招牌，拍照上传
- 系统使用OCR提取文字（店名、地址等）
- 系统查找匹配的POI，显示候选列表
- 显示距离、评分、营业状态等信息
- 提供"加入行程"按钮

**验收标准**：
- ✅ OCR提取准确
- ✅ POI匹配准确
- ✅ 显示完整信息
- ✅ 支持加入行程

---

## 13. 行程动作执行 (ScheduleAction)

### 模块概述
执行行程动作，包括移动POI、添加POI、查询下一站等。

### 核心用户故事

#### 故事 13.1：预览行程动作
**作为** 一个旅行者  
**我想要** 预览动作的效果  
**以便** 确认是否执行

**场景**：
- 用户点击"移动POI"按钮前，先预览效果
- 系统显示"将东京塔移动到上午，会影响后续3个点"的提示
- 显示差异信息（移动了哪些stop、新增、删除）
- 显示警告信息（时间冲突、影响范围等）

**验收标准**：
- ✅ 预览准确
- ✅ 差异信息清晰
- ✅ 警告信息准确
- ✅ 不实际修改数据

---

#### 故事 13.2：应用行程动作
**作为** 一个旅行者  
**我想要** 执行行程动作  
**以便** 修改我的行程安排

**场景**：
- 用户确认后，执行动作（移动、添加POI等）
- 系统修改Schedule，返回新的行程计划
- 查询下一站（QUERY_NEXT_STOP）返回答案但不修改schedule
- 执行后需要保存到数据库

**验收标准**：
- ✅ 动作执行成功
- ✅ Schedule正确更新
- ✅ 查询动作不修改数据
- ✅ 数据保存到数据库

---

## 14. LLM 智能服务 (LLM)

### 模块概述
提供基于大语言模型的智能服务，包括自然语言理解、结果人性化转化、决策支持等功能。支持多种LLM提供商（OpenAI、Gemini、DeepSeek、Anthropic）。

### 核心用户故事

#### 故事 14.1：自然语言转接口参数
**作为** 一个旅行者  
**我想要** 用自然语言描述我的旅行需求  
**以便** 系统自动转换为创建行程的参数

**场景**：
- 用户说："帮我规划带娃去东京5天的行程，预算2万"
- 系统使用LLM解析自然语言，提取关键信息
- 提取目的地、日期、预算、旅行者信息等参数
- 如果信息不足，返回澄清问题
- 如果信息充足，返回解析后的参数

**验收标准**：
- ✅ LLM正确解析自然语言
- ✅ 提取关键信息准确（目的地、日期、预算、旅行者信息）
- ✅ 信息不足时返回澄清问题
- ✅ 信息充足时返回完整参数
- ✅ 支持多种LLM提供商（OpenAI、Gemini、DeepSeek、Anthropic）
- ✅ 支持Mock模式（测试或网络不可用时）

---

#### 故事 14.2：结果人性化转化
**作为** 一个旅行者  
**我想要** 看到人性化的结果描述  
**以便** 更容易理解技术化的数据

**场景**：
- 路线优化后，系统返回技术化的结果（快乐值、分数详情等）
- 用户希望看到更易懂的描述
- 系统使用LLM将结构化数据转化为自然语言
- 支持多种数据类型（路线优化、What-If评估、行程计划、交通规划）

**验收标准**：
- ✅ 转化结果易读易懂
- ✅ 保留关键信息
- ✅ 支持多种数据类型
- ✅ 描述流畅自然

---

#### 故事 14.3：决策支持
**作为** 一个旅行者  
**我想要** 获得智能决策建议  
**以便** 做出更好的旅行规划决策

**场景**：
- What-If评估后，用户希望获得优化建议
- 系统基于评估结果提供智能建议
- 显示推荐建议列表（标题、描述、置信度、理由）
- 提供总结和可操作的建议

**验收标准**：
- ✅ 建议准确有用
- ✅ 置信度合理
- ✅ 理由清晰
- ✅ 建议可操作
- ✅ 提供总结

---

#### 故事 14.4：异常处理与追问
**作为** 一个旅行者  
**我想要** 在输入不清晰时得到帮助  
**以便** 系统能够理解我的需求

**场景**：
- 用户输入的自然语言不清晰或信息不足
- 系统检测到问题，使用LLM生成澄清问题
- 返回澄清问题列表和建议操作
- 用户回答后可以重新解析

**验收标准**：
- ✅ 异常检测准确
- ✅ 澄清问题有用
- ✅ 建议操作合理
- ✅ 支持重新解析

---

#### 故事 14.5：多LLM提供商支持
**作为** 一个系统管理员  
**我想要** 支持多种LLM提供商  
**以便** 根据需求选择最合适的服务

**场景**：
- 系统支持OpenAI、Gemini、DeepSeek、Anthropic等多种提供商
- 根据环境变量自动选择可用的提供商
- 支持在请求中指定提供商
- 如果某个提供商不可用，自动回退到Mock模式

**验收标准**：
- ✅ 支持多种LLM提供商
- ✅ 自动选择可用提供商
- ✅ 支持手动指定提供商
- ✅ 失败时自动回退
- ✅ Mock模式可用

---

## 15. 用户画像 (Users)

### 模块概述
管理用户画像数据，包括用户偏好、历史行程、收藏等。

### 核心用户故事

#### 故事 15.1：创建用户画像
**作为** 一个旅行者  
**我想要** 设置我的旅行偏好  
**以便** 系统能够为我推荐更合适的行程

**场景**：
- 用户首次使用时，填写旅行偏好
- 设置体力水平、兴趣偏好、预算敏感度等
- 系统保存用户画像数据
- 后续创建行程时自动应用用户画像

**验收标准**：
- ✅ 用户画像创建成功
- ✅ 偏好设置完整
- ✅ 自动应用到行程创建
- ✅ 支持更新用户画像

---

#### 故事 15.2：查看历史行程
**作为** 一个旅行者  
**我想要** 查看我的历史行程  
**以便** 回顾过去的旅行经历

**场景**：
- 用户查看我的行程列表
- 显示所有历史行程（按时间排序）
- 显示行程状态（规划中/进行中/已完成）
- 支持筛选和搜索

**验收标准**：
- ✅ 历史行程列表完整
- ✅ 排序正确
- ✅ 状态显示准确
- ✅ 支持筛选和搜索

---

## 16. 系统状态 (System)

### 模块概述
提供系统能力查询和状态检查功能。

### 核心用户故事

#### 故事 16.1：检查系统能力
**作为** 一个用户  
**我想要** 知道系统各功能模块的状态  
**以便** 了解哪些功能可用

**场景**：
- 应用启动时，检查系统各功能模块的状态
- 显示OCR、POI、ASR、TTS、LLM等提供商状态
- 显示限流信息和功能开关状态
- 如果某个功能不可用，显示提示信息

**验收标准**：
- ✅ 系统状态查询准确
- ✅ 提供商状态正确
- ✅ 限流信息准确
- ✅ 功能开关状态正确
- ✅ 提示信息清晰

---

#### 故事 16.2：查看功能可用性
**作为** 一个用户  
**我想要** 知道哪些功能可用  
**以便** 决定使用哪些功能

**场景**：
- 用户查看系统状态页面
- 显示各功能模块的可用性（OCR、POI、ASR、TTS、LLM）
- 显示提供商状态（mock/google/unavailable等）
- 如果某个功能不可用，显示原因和建议

**验收标准**：
- ✅ 功能可用性显示准确
- ✅ 提供商状态正确
- ✅ 不可用时显示原因
- ✅ 提供建议操作

---

## 📝 总结

本文档按模块组织了所有用户故事，涵盖了整个智能旅行规划系统的核心功能。每个模块都包含：

1. **模块概述**：说明模块的主要作用
2. **核心用户故事**：使用标准的用户故事格式（作为...我想要...以便...）
3. **场景**：详细描述用户使用场景
4. **验收标准**：明确的功能验收标准

这些用户故事可以帮助：
- **产品经理**：理解产品功能和用户需求
- **开发人员**：理解业务逻辑和实现要求
- **测试人员**：编写测试用例和验收测试
- **新团队成员**：快速了解项目功能

---



