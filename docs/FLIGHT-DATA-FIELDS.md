# 航班数据字段说明

## 数据文件字段

根据您提供的数据文件，包含以下字段：

| 字段名 | 类型 | 说明 | 是否必需 |
|--------|------|------|---------|
| **出发城市** | String | 出发城市名称（如：成都） | ✅ **必需** |
| **到达城市** | String | 到达城市名称（如：深圳） | ✅ **必需** |
| **日期** | Date | 航班日期（格式：2024/1/1 或 2024-01-01） | ✅ **必需** |
| **价格(元)** | Number | 航班价格（元） | ✅ **必需** |
| **起飞机场** | String | 起飞机场名称（如：双流机场） | ⭐ **推荐** |
| **起飞机场x** | Number | 起飞机场经度（如：103.9652352） | ⭐ **推荐** |
| **起飞机场y** | Number | 起飞机场纬度（如：30.58461845） | ⭐ **推荐** |
| **降落机场** | String | 降落机场名称（如：宝安机场） | ⭐ **推荐** |
| **降落机场x** | Number | 降落机场经度（如：113.8368339） | ⭐ **推荐** |
| **降落机场y** | Number | 降落机场纬度（如：22.64648838） | ⭐ **推荐** |
| **里程（公里）** | Number | 航线里程（公里） | 可选 |
| **航班班次** | String | 航班号（如：MU5319） | 可选 |
| **航空公司** | String | 航空公司名称（如：东方航空） | 可选 |

## 字段用途

### 必需字段（用于价格估算）

1. **出发城市 + 到达城市** → 创建 `routeId`（如：`成都->深圳`）
2. **日期** → 计算：
   - `month`（月份：1-12）
   - `dayOfWeek`（星期几：0=周一, 6=周日）
3. **价格(元)** → 计算：
   - `monthlyBasePrice`（月度基准价）
   - `dayOfWeekFactor`（周内因子）
   - 统计信息（min/max/stdDev）

### 推荐字段（机场经纬度）

**为什么需要机场经纬度？**

1. **精确距离计算**
   - 机场到机场的实际距离（比城市中心距离更准确）
   - 可用于验证和优化价格模型

2. **交通规划**
   - 计算机场到市区的距离
   - 估算从机场到酒店的交通时间和成本
   - 优化行程路线（考虑机场位置）

3. **数据分析**
   - 不同机场的价格差异分析
   - 机场位置对价格的影响

4. **用户体验**
   - 显示具体机场信息（如：成都双流国际机场 → 深圳宝安国际机场）
   - 提供机场位置地图
   - 机场交通指南

### 可选字段

- **里程（公里）**：可用于验证距离与价格的关系
- **航班班次**：可用于更细粒度的分析（特定航班价格趋势）
- **航空公司**：可用于分析不同航空公司的价格差异

## 数据库表结构

### FlightPriceDetail 表

```prisma
model FlightPriceDetail {
  // 核心字段（必需）
  routeId            String   // "成都->深圳"
  originCity         String   // "成都"
  destinationCity    String   // "深圳"
  month              Int      // 1-12
  dayOfWeek          Int?     // 0=周一, 6=周日
  monthlyBasePrice   Float    // 月度基准价
  dayOfWeekFactor    Float?   // 周内因子
  
  // 机场信息（推荐）
  originAirport              String?  // "双流机场"
  originAirportLongitude     Float?   // 103.9652352
  originAirportLatitude      Float?   // 30.58461845
  destinationAirport         String?  // "宝安机场"
  destinationAirportLongitude Float?   // 113.8368339
  destinationAirportLatitude  Float?   // 22.64648838
  
  // 统计信息
  sampleCount  Int
  minPrice     Float?
  maxPrice     Float?
  stdDev       Float?
}
```

## 导入脚本处理逻辑

### 数据收集

1. **必需字段验证**：跳过缺少必需字段的记录
2. **价格验证**：过滤价格 <= 0 或 >= 100000 的记录
3. **机场信息收集**：保存第一条有效记录的机场信息

### 数据聚合

- 按 `routeId + month + dayOfWeek` 分组
- 计算统计信息（平均值、最小值、最大值、标准差）
- 保存机场信息（取第一个有效值）

### 数据存储

- 如果记录已存在：更新价格统计信息，保留或更新机场信息
- 如果记录不存在：创建新记录，包含所有字段

## 使用建议

### 对于价格估算

**最小数据集**（必需字段）：
- 出发城市
- 到达城市
- 日期
- 价格(元)

**完整数据集**（推荐）：
- 上述字段 + 机场名称和经纬度

### 对于高级功能

如果需要以下功能，建议包含机场经纬度：
- 机场到市区的交通规划
- 多机场城市的价格对比（如：北京首都 vs 北京大兴）
- 机场位置对价格的影响分析
- 地图可视化

## 示例数据

```csv
出发城市,到达城市,起飞机场,起飞机场x,起飞机场y,降落机场,降落机场x,降落机场y,日期,价格(元)
成都,深圳,双流机场,103.9652352,30.58461845,宝安机场,113.8368339,22.64648838,2024/1/1,2375
```

## 总结

- ✅ **必需字段**：出发城市、到达城市、日期、价格(元)
- ⭐ **推荐字段**：机场名称和经纬度（用于精确计算和用户体验）
- 📊 **可选字段**：里程、航班班次、航空公司（用于高级分析）

**建议**：如果数据源包含机场经纬度，请务必导入，这将大大提升系统的功能和用户体验。

